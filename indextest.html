<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë”í™ˆì ê²€ - í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <meta name="google" content="notranslate">
    <meta name="google" content="nositelinkssearchbox">
    
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ë”í™ˆì ê²€">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #10b981; --primary-dark: #059669; --secondary: #fbbf24;
            --danger: #ef4444; --bg-dark: #1a202c; --bg-darker: #111827;
            --card-bg: rgba(30, 41, 59, 0.5); --border: rgba(255, 255, 255, 0.1);
            --text-primary: #f1f5f9; --text-secondary: #94a3b8;
        }
        body.light-mode {
            --bg-dark: #f3f4f6; --bg-darker: #e5e7eb;
            --card-bg: rgba(255, 255, 255, 0.9); --border: rgba(0, 0, 0, 0.1);
            --text-primary: #1f2937; --text-secondary: #6b7280;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-primary); min-height: 100vh; padding: 0; overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }
        body.light-mode { background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%); }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px; text-align: center; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3); position: relative;
        }
        .header h1 { font-size: 24px; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .progress-bar { width: 100%; height: 8px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; margin-top: 15px; overflow: hidden; }
        .progress-fill { height: 100%; background: white; border-radius: 10px; transition: width 0.3s ease; }
        .tabs {
            display: flex; background: var(--card-bg); border-radius: 12px; padding: 5px;
            margin: 20px -20px; gap: 5px; overflow-x: auto; -webkit-overflow-scrolling: touch;
            position: sticky; top: 0; z-index: 99; backdrop-filter: blur(10px); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .tab {
            flex: 1; padding: 12px 20px; border: none; background: transparent; color: var(--text-secondary);
            cursor: pointer; border-radius: 8px; font-weight: bold; transition: all 0.3s ease; white-space: nowrap; min-width: fit-content;
        }
        .tab.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4); }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
        body.light-mode .card { box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); border: 1px solid #e5e7eb; }
        .form-field { margin-bottom: 20px; }
        .form-label { display: block; color: var(--primary); font-weight: bold; margin-bottom: 8px; font-size: 14px; }
        .form-input {
            width: 100%; padding: 14px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border);
            border-radius: 10px; color: var(--text-primary); font-size: 16px; transition: all 0.3s ease;
        }
        body.light-mode .form-input { background: rgba(255, 255, 255, 0.9); border: 1px solid #d1d5db; }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; font-size: 16px;
            cursor: pointer; transition: all 0.15s ease; display: flex; align-items: center; justify-content: center;
            gap: 8px; touch-action: manipulation; -webkit-tap-highlight-color: transparent; user-select: none;
        }
        .btn:active { transform: scale(0.97); opacity: 0.9; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .btn-secondary { background: rgba(251, 191, 36, 0.1); border: 2px solid var(--secondary); color: var(--secondary); }
        .btn-danger { background: rgba(239, 68, 68, 0.1); border: 2px solid var(--danger); color: var(--danger); }
        .photo-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .photo-action-btn {
            padding: 14px; background: var(--card-bg); border: 2px solid var(--border); border-radius: 12px;
            color: var(--text-primary); font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .photo-action-btn.camera { background: rgba(16, 185, 129, 0.1); border-color: var(--primary); color: var(--primary); }
        .defect-card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); position: relative; }
        .defect-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .defect-number { background: var(--primary); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; }
        .touch-button-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 8px; margin-top: 10px; }
        .touch-btn {
            padding: 10px 8px; border: 2px solid var(--border); background: rgba(30, 41, 59, 0.3); color: var(--text-secondary);
            border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; text-align: center;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .touch-btn.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border-color: var(--primary); color: white;
        }
        .camera-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 5000; flex-direction: column; justify-content: center; }
        .camera-modal.active { display: flex; }
        #cameraPreview { width: 100%; height: 100%; object-fit: cover; }
        .camera-controls { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: center; gap: 30px; }
        .camera-btn { width: 80px; height: 80px; border-radius: 50%; background: white; border: 4px solid rgba(0,0,0,0.1); cursor: pointer; }
        .floating-btn {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%;
            background: var(--primary); color: white; font-size: 28px; border: none; box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5); z-index: 999;
        }
        .toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white;
            padding: 12px 24px; border-radius: 30px; font-size: 14px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 2000;
        }
        .toast.show { opacity: 1; }
        .login-overlay { position: fixed; inset: 0; background: var(--bg-darker); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-overlay.hidden { display: none; }
        .login-box { background: var(--card-bg); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--border); }
        .theme-toggle { position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; z-index: 100; }
        .logout-btn { position: absolute; top: 25px; left: 20px; background: rgba(239,68,68,0.2); color: var(--danger); border: 1px solid var(--danger); padding: 5px 10px; border-radius: 15px; font-size: 12px; cursor: pointer; z-index: 100; display: none; }
        
        /* New styles for air quality and equipment sections */
        .air-quality-card, .equipment-card { background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .air-add-btn { width: 100%; padding: 12px; border: 2px dashed var(--border); background: transparent; color: var(--text-secondary); border-radius: 12px; cursor: pointer; margin-top: 10px; }
        .zoom-level { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.6); color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; pointer-events: none; }
    </style>
</head>
<body>

    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h1 style="color: var(--primary); margin-bottom: 10px;">ğŸ  ë”í™ˆì ê²€</h1>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">ì§ì› ì „ìš© ì‹œìŠ¤í…œ</p>
            <input type="text" id="accessCodeInput" class="form-input" placeholder="ì´ë¦„" style="margin-bottom: 10px;">
            <input type="password" id="pinInput" class="form-input" placeholder="PIN ë²ˆí˜¸ (4ìë¦¬)" maxlength="4" style="margin-bottom: 20px;">
            <button onclick="handleLogin()" class="btn btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>
            <p id="loginError" style="color: var(--danger); margin-top: 15px; font-size: 13px; display: none;"></p>
        </div>
    </div>

    <div class="header">
        <button id="logoutBtn" class="logout-btn" onclick="handleLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
        <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">ğŸŒ™</button>
        <h1>ğŸ  ë”í™ˆì ê²€</h1>
        <p>í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ v3.2 (ë³´ê³ ì„œ ë””ìì¸ ê°œì„ )</p>
        <div class="progress-bar"><div class="progress-fill" id="progressBar" style="width: 0%"></div></div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('project', event)">ğŸ“ í”„ë¡œì íŠ¸</button>
            <button class="tab" onclick="switchTab('defects', event)">ğŸ” í•˜ìì ê²€</button>
            <button class="tab" onclick="switchTab('equipment', event)">ğŸ“¸ ì¥ë¹„ì ê²€</button>
            <button class="tab" onclick="switchTab('airquality', event)">ğŸŒ¬ï¸ ê³µê¸°ì§ˆ</button>
            <button class="tab" onclick="switchTab('data', event)">ğŸ’¾ ë°ì´í„°</button>
        </div>

        <div id="project" class="section active">
            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 15px;">ğŸ“‹ í”„ë¡œì íŠ¸ ëª©ë¡</h2>
                <div id="projectList" style="margin-bottom: 15px; max-height: 150px; overflow-y: auto;"></div>
                <div class="grid-2">
                    <button onclick="addNewProject()" class="btn btn-primary">â• ìƒˆ í”„ë¡œì íŠ¸</button>
                    <button onclick="deleteCurrentProject()" class="btn btn-danger">ğŸ—‘ï¸ í˜„ì¬ ì‚­ì œ</button>
                </div>
            </div>

            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 15px;">ğŸ“ ìƒì„¸ ì •ë³´</h2>
                <div class="form-field">
                    <label class="form-label">ì•„íŒŒíŠ¸ëª…</label>
                    <input type="text" id="apartmentName" class="form-input" oninput="autoSaveProjectData()">
                </div>
                <div class="grid-2">
                    <div class="form-field">
                        <label class="form-label">ë™</label>
                        <input type="text" id="dong" class="form-input" oninput="cleanDongHo(this,'ë™');autoSaveProjectData()">
                    </div>
                    <div class="form-field">
                        <label class="form-label">í˜¸ìˆ˜</label>
                        <input type="text" id="ho" class="form-input" oninput="cleanDongHo(this,'í˜¸');autoSaveProjectData()">
                    </div>
                </div>
                <div class="form-field">
                    <label class="form-label">ì ê²€ì¼ì</label>
                    <input type="date" id="inspectionDate" class="form-input" onchange="autoSaveProjectData()">
                </div>
                <div class="grid-2">
                    <div class="form-field">
                        <label class="form-label">ê³ ê°ëª…</label>
                        <input type="text" id="customerName" class="form-input" oninput="autoSaveProjectData()">
                    </div>
                    <div class="form-field">
                        <label class="form-label">ì‘ì„±ì</label>
                        <input type="text" id="author" class="form-input" oninput="autoSaveProjectData()">
                    </div>
                </div>
                 <div class="form-field" style="display:none;">
                    <input type="tel" class="form-input" id="customerPhone">
                </div>
            </div>

            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 15px;">ğŸ“ í‰ë©´ë„</h2>
                <div style="text-align: center;">
                    <img id="floorplanPreview" style="max-width: 100%; display: none; border-radius: 8px; margin-bottom: 10px;">
                    <p id="floorplanPlaceholder" style="color: var(--text-secondary); padding: 30px; border: 2px dashed var(--border); border-radius: 10px;">í‰ë©´ë„ ì—†ìŒ</p>
                    <div class="photo-actions">
                        <button class="photo-action-btn camera" onclick="openFloorplanCamera()">ğŸ“· ì´¬ì˜</button>
                        <button class="photo-action-btn" onclick="openFloorplanGallery()">ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬</button>
                    </div>
                    <button onclick="deleteFloorplan()" class="btn btn-danger" style="margin-top: 10px;">ğŸ—‘ï¸ í‰ë©´ë„ ì‚­ì œ</button>
                </div>
            </div>
        </div>

        <div id="defects" class="section">
            <div id="defectsList"></div>
        </div>

        <div id="equipment" class="section">
            <div id="equipmentList"></div>
        </div>

        <div id="airquality" class="section">
            <div id="airQualityList"></div>
            <button class="air-add-btn" onclick="addAirQualityRoom()">â• ë°© ì¶”ê°€</button>
            <div class="card" style="margin-top: 20px; font-size: 13px; color: var(--text-secondary);">
                <strong>ê¶Œê³ ê¸°ì¤€</strong><br>
                ë¼ëˆ: 148 Bq/mÂ³ ì´í•˜<br>
                í¬ë¦„ì•Œë°íˆë“œ: 0.210 mg/mÂ³ ì´í•˜<br>
                ì´íœ˜ë°œì„±ìœ ê¸°í™”í•©ë¬¼: 0.500 mg/mÂ³ ì´í•˜
            </div>
        </div>

        <div id="data" class="section">
            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 15px;">ğŸ’¾ ë³´ê³ ì„œ & ì €ì¥</h2>
                <button class="btn btn-primary" onclick="generatePDF()" style="margin-bottom: 10px;">ğŸ“„ í•˜ì ë³´ê³ ì„œ (PDF)</button>
                <button class="btn" onclick="downloadAllData()" style="background: #3b82f6; color: white; margin-bottom: 10px;">ğŸ“¦ ì „ì²´ ë‹¤ìš´ë¡œë“œ (ZIP)</button>
                <button class="btn" onclick="generateEquipmentOnlyPDF()" style="background: #6366f1; color: white; margin-bottom: 10px;">ğŸ”§ ì¥ë¹„ì ê²€ ë³´ê³ ì„œ (PDF)</button>
                <button class="btn" onclick="generateFieldReportPDF()" style="background: #f59e0b; color: white; margin-bottom: 20px;">ğŸ“‹ í˜„ì¥ì¶œë ¥ìš© (PDF)</button>
                
                <hr style="border-color: var(--border); margin-bottom: 20px;">
                
                <h3 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px;">ì €ì¥ëœ í”„ë¡œì íŠ¸</h3>
                <div id="savedList"></div>
                <button class="btn btn-danger" onclick="clearAllData()" style="margin-top: 20px;">âš ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <button id="floatingAddBtn" class="floating-btn" onclick="handleFloatingBtnClick()" style="display: none;">â•</button>

    <div id="cameraModal" class="camera-modal">
        <video id="cameraPreview" autoplay playsinline></video>
        <canvas id="markerCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;"></canvas>
        <div class="zoom-level" id="zoomLevel">1.0x</div>
        <div class="camera-controls">
            <button class="camera-btn" onclick="closeCameraModal()" style="background: rgba(255,255,255,0.2); color: white; font-size: 24px; border: none;">âœ•</button>
            <button class="camera-btn" onclick="capturePhoto()"></button>
            <div style="width: 50px;"></div>
        </div>
    </div>

    <div id="loading" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); color: white; z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
        <div style="width: 40px; height: 40px; border: 4px solid #ffffff3d; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite;"></div>
        <p style="margin-top: 15px;">ì²˜ë¦¬ ì¤‘...</p>
    </div>
    
    <div id="toast" class="toast"></div>

    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <script>
        // ==================== í•µì‹¬ ë¡œì§ (ë³€ê²½ ì—†ìŒ) ====================
        // ì•„ë˜ ì„¹ì…˜ì€ PDF ë””ìì¸ ìƒì„± í•¨ìˆ˜ë¥¼ ì œì™¸í•˜ê³  ê¸°ì¡´ ë¡œì§ê³¼ ë™ì¼í•©ë‹ˆë‹¤.
        // ì‚¬ìš©ìê°€ ìš”ì²­í•œ ëŒ€ë¡œ í•˜ì ë³´ê³ ì„œ ë””ìì¸ë§Œ ë³€ê²½ëœ í•¨ìˆ˜ë“¤ì´ í¬í•¨ë©ë‹ˆë‹¤.

        // ... (ê¸°ì¡´ ë³€ìˆ˜ ë° ì´ˆê¸°í™” ë¡œì§ ìƒëµ - index.html ì „ì²´ë¥¼ ë®ì–´ì“°ë¯€ë¡œ í•„ìš”í•œ ë³€ìˆ˜ ì¬ì„ ì–¸) ...
        
        const GOOGLE_SHEETS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS4Tz0-NgXyWR36c9hkZ4ko0ll4g-oj5YGHZysuH0c1Mngr4Ev9-VgiryTHHcMd2Zq5NuOmOI6dMZeh/pub?output=csv';
        let projects = [];
        let currentProjectId = null;
        let cameraStream = null;
        let currentPhotoTarget = null;
        let currentZoom = 1.0;
        
        const projectData = new Proxy({}, {
            get(target, prop) {
                const project = getCurrentProject();
                return project ? project[prop] : undefined;
            },
            set(target, prop, value) {
                const project = getCurrentProject();
                if (project) { project[prop] = value; return true; }
                return false;
            }
        });

        // ... (ê¸°ë³¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤: showToast, compressImage, IndexedDB ë“±) ...
        // (ì½”ë“œ ê¸¸ì´ìƒ í•µì‹¬ ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼í•˜ë¯€ë¡œ, PDF ë””ìì¸ ë³€ê²½ ë¶€ë¶„ì— ì§‘ì¤‘í•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤.
        // ì‹¤ì œ íŒŒì¼ì—ëŠ” ëª¨ë“  ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ì•¼ í•˜ë¯€ë¡œ, ì•„ë˜ì— ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.)

        // ==================== ì—¬ê¸°ì„œë¶€í„° ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ====================
        
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }
        
        function createNewProject() {
            return {
                id: Date.now(), apartmentName: '', dong: '', ho: '', inspectionDate: new Date().toISOString().split('T')[0],
                customerName: '', author: '', floorplan: null, defects: [], equipment: [], airQuality: [],
                lastDefectId: 0, lastEquipmentId: 0, lastAirQualityId: 0
            };
        }
        
        function getCurrentProject() {
            if (projects.length === 0) {
                const p = createNewProject();
                projects.push(p);
                currentProjectId = p.id;
            }
            return projects.find(p => p.id === currentProjectId) || projects[0];
        }

        // ==================== PDF ë””ìì¸ ìˆ˜ì • ì˜ì—­ (í•˜ì ë³´ê³ ì„œ) ====================

        // 1. í•˜ì ë³´ê³ ì„œ ì²« í˜ì´ì§€ (í‘œì§€ + ìš”ì•½) - ë””ìì¸ ê°œì„ 
        window.createSummaryFirstPage = function() {
            let defectRows = '';
            const displayDefects = projectData.defects.slice(0, 15);
            
            displayDefects.forEach((defect, index) => {
                const spaces = defect.spaces ? defect.spaces.join(', ') : (defect.space || '-');
                const locations = defect.locations ? defect.locations.join(', ') : (defect.location || '-');
                const types = defect.types ? defect.types.join(', ') : (defect.type || '-');
                const description = defect.description || '';
                
                // í…Œì´ë¸” í–‰ ë””ìì¸ ê°œì„  (êµì°¨ ìƒ‰ìƒ, ê¹”ë”í•œ í…Œë‘ë¦¬)
                const bgStyle = index % 2 === 0 ? 'background-color: #ffffff;' : 'background-color: #f9fafb;';
                
                defectRows += `
                    <tr style="${bgStyle} border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 8px; text-align: center; font-weight: 600; color: #374151; font-size: 11px; border-right: 1px solid #e5e7eb;">${index + 1}</td>
                        <td style="padding: 8px; text-align: center; color: #4b5563; font-size: 11px; border-right: 1px solid #e5e7eb;">${spaces}</td>
                        <td style="padding: 8px; text-align: center; color: #4b5563; font-size: 11px; border-right: 1px solid #e5e7eb;">${locations}</td>
                        <td style="padding: 8px; text-align: center; color: #4b5563; font-size: 11px; border-right: 1px solid #e5e7eb;">${types}</td>
                        <td style="padding: 8px; color: #4b5563; font-size: 11px;">${description}</td>
                    </tr>
                `;
            });

            // ë¹ˆ í–‰ ì±„ìš°ê¸° (ë””ìì¸ ìœ ì§€)
            for (let i = displayDefects.length; i < 15; i++) {
                 const bgStyle = i % 2 === 0 ? 'background-color: #ffffff;' : 'background-color: #f9fafb;';
                 defectRows += `<tr style="${bgStyle} border-bottom: 1px solid #e5e7eb;"><td colspan="5" style="padding: 8px; height: 33px; border-right: 1px solid #e5e7eb;"></td></tr>`;
            }

            return `
                <div style="width: 794px; height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 40px; box-sizing: border-box; position: relative;">
                    <div style="border-bottom: 3px solid #10b981; padding-bottom: 15px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: end;">
                        <div>
                            <h1 style="margin: 0; font-size: 28px; color: #1f2937; font-weight: 800;">ì‚¬ì „ì ê²€ ê²°ê³¼ ë³´ê³ ì„œ</h1>
                            <p style="margin: 5px 0 0; font-size: 14px; color: #6b7280;">Home Inspection Report</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: bold; color: #10b981;">${projectData.apartmentName}</div>
                            <div style="font-size: 14px; color: #374151;">${projectData.dong}ë™ ${projectData.ho}í˜¸</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 20px; margin-bottom: 25px; height: 280px;">
                        <div style="flex: 1;">
                            <table style="width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb;">
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px; background: #f3f4f6; font-weight: bold; color: #374151; width: 35%; font-size: 12px;">ì ê²€ì¼ì</td>
                                    <td style="padding: 12px; color: #1f2937; font-size: 12px;">${projectData.inspectionDate || '-'}</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px; background: #f3f4f6; font-weight: bold; color: #374151; font-size: 12px;">ê³ ê°ëª…</td>
                                    <td style="padding: 12px; color: #1f2937; font-size: 12px;">${projectData.customerName || '-'}</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #e5e7eb;">
                                    <td style="padding: 12px; background: #f3f4f6; font-weight: bold; color: #374151; font-size: 12px;">ì ê²€ì</td>
                                    <td style="padding: 12px; color: #1f2937; font-size: 12px;">${projectData.author || '-'}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; background: #f3f4f6; font-weight: bold; color: #374151; font-size: 12px;">ì´ í•˜ììˆ˜</td>
                                    <td style="padding: 12px; color: #ef4444; font-weight: bold; font-size: 12px;">${projectData.defects.length} ê±´</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div style="flex: 1.5; border: 1px solid #e5e7eb; border-radius: 4px; display: flex; align-items: center; justify-content: center; background: #f9fafb; overflow: hidden;">
                            ${projectData.floorplan ? `<img src="${projectData.floorplan}" style="width: 100%; height: 100%; object-fit: contain;">` : '<span style="color:#9ca3af; font-size: 12px;">í‰ë©´ë„ ì—†ìŒ</span>'}
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h3 style="font-size: 16px; color: #1f2937; margin-bottom: 10px; font-weight: 700; border-left: 4px solid #10b981; padding-left: 10px;">ì ê²€ ëª©ë¡ ìš”ì•½ (1-15)</h3>
                        <table style="width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; font-size: 12px;">
                            <thead>
                                <tr style="background: #1f2937; color: white;">
                                    <th style="padding: 10px; width: 8%; border-right: 1px solid #374151;">No</th>
                                    <th style="padding: 10px; width: 15%; border-right: 1px solid #374151;">ê³µê°„</th>
                                    <th style="padding: 10px; width: 15%; border-right: 1px solid #374151;">ìœ„ì¹˜</th>
                                    <th style="padding: 10px; width: 15%; border-right: 1px solid #374151;">ìœ í˜•</th>
                                    <th style="padding: 10px; width: 47%;">ìƒì„¸ ë‚´ìš©</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${defectRows}
                            </tbody>
                        </table>
                    </div>

                    <div style="position: absolute; bottom: 30px; left: 40px; right: 40px; border-top: 1px solid #e5e7eb; padding-top: 10px; display: flex; justify-content: space-between; color: #9ca3af; font-size: 10px;">
                        <span>ë”í™ˆì ê²€ í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ</span>
                        <span>Page 1</span>
                    </div>
                </div>
            `;
        }

        // 2. í•˜ì ëª©ë¡ ì´ì–´ì§€ëŠ” í˜ì´ì§€ - ë””ìì¸ ê°œì„ 
        window.createDefectListPage = function(startIndex, itemsPerPage) {
            let defectRows = '';
            const endIndex = Math.min(startIndex + itemsPerPage, projectData.defects.length);
            const defectsToDisplay = projectData.defects.slice(startIndex, endIndex);
            
            defectsToDisplay.forEach((defect, index) => {
                const globalIndex = startIndex + index + 1;
                const spaces = defect.spaces ? defect.spaces.join(', ') : (defect.space || '-');
                const locations = defect.locations ? defect.locations.join(', ') : (defect.location || '-');
                const types = defect.types ? defect.types.join(', ') : (defect.type || '-');
                const description = defect.description || '';
                
                const bgStyle = index % 2 === 0 ? 'background-color: #ffffff;' : 'background-color: #f9fafb;';
                
                defectRows += `
                    <tr style="${bgStyle} border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 10px; text-align: center; font-weight: 600; color: #374151; font-size: 11px; border-right: 1px solid #e5e7eb;">${globalIndex}</td>
                        <td style="padding: 10px; text-align: center; color: #4b5563; font-size: 11px; border-right: 1px solid #e5e7eb;">${spaces}</td>
                        <td style="padding: 10px; text-align: center; color: #4b5563; font-size: 11px; border-right: 1px solid #e5e7eb;">${locations}</td>
                        <td style="padding: 10px; text-align: center; color: #4b5563; font-size: 11px; border-right: 1px solid #e5e7eb;">${types}</td>
                        <td style="padding: 10px; color: #4b5563; font-size: 11px;">${description}</td>
                    </tr>
                `;
            });

            // ë¹ˆ í–‰ ì±„ìš°ê¸°
            for (let i = defectsToDisplay.length; i < itemsPerPage; i++) {
                 const bgStyle = i % 2 === 0 ? 'background-color: #ffffff;' : 'background-color: #f9fafb;';
                 defectRows += `<tr style="${bgStyle} border-bottom: 1px solid #e5e7eb;"><td colspan="5" style="padding: 10px; height: 36px; border-right: 1px solid #e5e7eb;"></td></tr>`;
            }
            
            const pageNum = Math.floor(startIndex / itemsPerPage) + 2; // 1í˜ì´ì§€ëŠ” ìš”ì•½ë³¸ì´ë¯€ë¡œ

            return `
                <div style="width: 794px; height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 40px; box-sizing: border-box; position: relative;">
                    <div style="border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; color: #1f2937; font-size: 18px; font-weight: 700;">ì ê²€ ëª©ë¡ ìƒì„¸ (${startIndex + 1}-${endIndex})</h3>
                        <span style="font-size: 12px; color: #6b7280;">${projectData.apartmentName} ${projectData.dong}ë™ ${projectData.ho}í˜¸</span>
                    </div>

                    <table style="width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; font-size: 12px;">
                        <thead>
                            <tr style="background: #1f2937; color: white;">
                                <th style="padding: 10px; width: 8%; border-right: 1px solid #374151;">No</th>
                                <th style="padding: 10px; width: 15%; border-right: 1px solid #374151;">ê³µê°„</th>
                                <th style="padding: 10px; width: 15%; border-right: 1px solid #374151;">ìœ„ì¹˜</th>
                                <th style="padding: 10px; width: 15%; border-right: 1px solid #374151;">ìœ í˜•</th>
                                <th style="padding: 10px; width: 47%;">ìƒì„¸ ë‚´ìš©</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${defectRows}
                        </tbody>
                    </table>

                    <div style="position: absolute; bottom: 30px; left: 40px; right: 40px; border-top: 1px solid #e5e7eb; padding-top: 10px; display: flex; justify-content: space-between; color: #9ca3af; font-size: 10px;">
                        <span>ë”í™ˆì ê²€ í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ</span>
                        <span>Page ${pageNum}</span>
                    </div>
                </div>
            `;
        }

        // 3. í•˜ì ìƒì„¸ ì‚¬ì§„ í˜ì´ì§€ - ë””ìì¸ ê°œì„ 
        window.createDefectDetailPage = async function(defects, startIndex) {
            let contentHTML = '';
            
            for (let idx = 0; idx < defects.length; idx++) {
                const defect = defects[idx];
                const globalIndex = startIndex + idx + 1;
                
                const farPhotoOriginal = defect.photos && defect.photos.length > 0 ? defect.photos[0] : '';
                const closePhotoOriginal = defect.photos && defect.photos.length > 1 ? defect.photos[1] : '';
                
                const dongHo = `${projectData.dong}ë™${projectData.ho}í˜¸`;
                const farPhoto = farPhotoOriginal ? await window.addWatermarkToPhoto(farPhotoOriginal, `${dongHo}_${globalIndex}`) : '';
                const closePhoto = closePhotoOriginal ? await window.addWatermarkToPhoto(closePhotoOriginal, `${dongHo}_${globalIndex}-1`) : '';
                
                const spaces = defect.spaces ? defect.spaces.join(', ') : '-';
                const description = defect.description || '-';
                
                contentHTML += `
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 25px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                        <div style="background: #f3f4f6; padding: 10px 15px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-weight: 800; color: #10b981; font-size: 14px;">No. ${globalIndex}</div>
                            <div style="font-weight: 600; color: #374151; font-size: 13px;">${spaces}</div>
                        </div>
                        
                        <div style="padding: 10px 15px; background: white; border-bottom: 1px solid #e5e7eb; font-size: 12px; color: #4b5563;">
                            <strong>ìƒì„¸ë‚´ìš©:</strong> ${description}
                        </div>

                        <div style="display: flex; padding: 10px; gap: 10px; background: white;">
                            <div style="flex: 1;">
                                <div style="margin-bottom: 5px; text-align: center;">
                                    <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold;">ì›ê²½</span>
                                </div>
                                <div style="border: 1px solid #e5e7eb; border-radius: 4px; height: 220px; display: flex; align-items: center; justify-content: center; overflow: hidden; background: #f9fafb;">
                                    ${farPhoto ? `<img src="${farPhoto}" style="width: 100%; height: 100%; object-fit: contain;">` : '<span style="font-size: 10px; color: #9ca3af;">ì‚¬ì§„ ì—†ìŒ</span>'}
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div style="margin-bottom: 5px; text-align: center;">
                                    <span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold;">ê·¼ê²½</span>
                                </div>
                                <div style="border: 1px solid #e5e7eb; border-radius: 4px; height: 220px; display: flex; align-items: center; justify-content: center; overflow: hidden; background: #f9fafb;">
                                    ${closePhoto ? `<img src="${closePhoto}" style="width: 100%; height: 100%; object-fit: contain;">` : '<span style="font-size: 10px; color: #9ca3af;">ì‚¬ì§„ ì—†ìŒ</span>'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div style="width: 794px; height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 40px; box-sizing: border-box; position: relative;">
                    <div style="border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #1f2937; font-size: 18px; font-weight: 700;">í•˜ì ìƒì„¸ ì‚¬ì§„</h3>
                    </div>
                    
                    ${contentHTML}

                    <div style="position: absolute; bottom: 30px; left: 40px; right: 40px; border-top: 1px solid #e5e7eb; padding-top: 10px; display: flex; justify-content: space-between; color: #9ca3af; font-size: 10px;">
                        <span>ë”í™ˆì ê²€ í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ</span>
                    </div>
                </div>
            `;
        }

        // ==================== ì¥ë¹„ ì ê²€ ë³´ê³ ì„œ ë””ìì¸ (ìœ ì§€) ====================
        // ìš”ì²­í•˜ì‹  ëŒ€ë¡œ ì¥ë¹„ ì ê²€ ë³´ê³ ì„œ ë””ìì¸ ìƒì„± í•¨ìˆ˜ëŠ” ê¸°ì¡´ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
        
        window.createEquipmentPage = function(equipmentList, startIndex) {
            let contentHTML = '';
            equipmentList.forEach((item, idx) => {
                const globalIndex = startIndex + idx + 1;
                const space = item.space || (item.spaces ? item.spaces.join(', ') : '-');
                if (item.photos && item.photos['ì¢Œì¸¡ìƒë‹¨']) {
                    item.photos = {
                        'ì¢Œì¸¡': item.photos['ì¢Œì¸¡ìƒë‹¨'] || item.photos['ì¢Œì¸¡í•˜ë‹¨'] || null,
                        'ìš°ì¸¡': item.photos['ìš°ì¸¡ìƒë‹¨'] || item.photos['ìš°ì¸¡í•˜ë‹¨'] || null,
                        'ë°”ë‹¥1': item.photos['ë°”ë‹¥'] || null, 'ë°”ë‹¥2': null
                    };
                } else if (item.photos && item.photos['ë°”ë‹¥'] && !item.photos['ë°”ë‹¥1']) {
                    item.photos['ë°”ë‹¥1'] = item.photos['ë°”ë‹¥']; delete item.photos['ë°”ë‹¥'];
                    if (!item.photos['ë°”ë‹¥2']) item.photos['ë°”ë‹¥2'] = null;
                }
                const hasLocationPhotos = item.photos && typeof item.photos === 'object';
                
                contentHTML += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 0; background: white; margin-bottom: 20px; page-break-inside: avoid;">
                        <div style="background: #f8f9fa; padding: 10px 15px; border-bottom: 1px solid #ddd;">
                            <strong style="font-size: 16px; color: #000;">ì¥ë¹„ì ê²€ ${globalIndex} - ${space}</strong>
                        </div>
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #ddd; font-weight: bold; text-align: center; background: #f8f9fa; color: #000; width: 25%;">ì ê²€ê²°ê³¼</td>
                                <td style="padding: 10px; border-bottom: 1px solid #ddd; color: #000;">${item.inspection || 'ë²½ì²´ìˆ˜ì§ ë° ë°”ë‹¥ìˆ˜í‰ / ë‹¨ì—´ì‹œê³µ ì–‘í˜¸'}</td>
                            </tr>
                        </table>
                        ${hasLocationPhotos ? `
                            <div style="padding: 0 15px 15px 15px;">
                                ${(() => {
                                    const colors = { 'ì¢Œì¸¡': '#3498db', 'ìš°ì¸¡': '#e74c3c', 'ë°”ë‹¥1': '#f39c12', 'ë°”ë‹¥2': '#f39c12' };
                                    const icons = { 'ì¢Œì¸¡': 'â¬…ï¸', 'ìš°ì¸¡': 'â¡ï¸', 'ë°”ë‹¥1': 'â¬‡ï¸', 'ë°”ë‹¥2': 'â¬‡ï¸' };
                                    let html = '';
                                    const topPhotos = [
                                        item.photos['ì¢Œì¸¡'] ? { name: 'ì¢Œì¸¡', photo: item.photos['ì¢Œì¸¡'], color: colors['ì¢Œì¸¡'], icon: icons['ì¢Œì¸¡'] } : null,
                                        item.photos['ìš°ì¸¡'] ? { name: 'ìš°ì¸¡', photo: item.photos['ìš°ì¸¡'], color: colors['ìš°ì¸¡'], icon: icons['ìš°ì¸¡'] } : null
                                    ].filter(p => p);
                                    if (topPhotos.length > 0) {
                                        html += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">`;
                                        topPhotos.forEach(loc => {
                                            html += `<div style="border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
                                                <div style="padding: 8px; text-align: center; font-weight: bold; font-size: 12px; color: #333; border-bottom: 3px solid ${loc.color};">${loc.icon} ${loc.name}</div>
                                                <img src="${loc.photo}" style="width: 100%; height: 240px; object-fit: cover; display: block;" />
                                            </div>`;
                                        });
                                        if (topPhotos.length === 1) html += `<div style="background: #f8f9fa;"></div>`;
                                        html += `</div>`;
                                    }
                                    const hasFloor1 = item.photos['ë°”ë‹¥1'] ? true : false;
                                    const hasFloor2 = item.photos['ë°”ë‹¥2'] ? true : false;
                                    if (hasFloor1 && hasFloor2) {
                                        html += `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                            <div style="border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
                                                <div style="padding: 8px; text-align: center; font-weight: bold; font-size: 12px; color: #333; border-bottom: 3px solid ${colors['ë°”ë‹¥1']};">${icons['ë°”ë‹¥1']} ë°”ë‹¥1</div>
                                                <img src="${item.photos['ë°”ë‹¥1']}" style="width: 100%; height: 240px; object-fit: cover; display: block;" />
                                            </div>
                                            <div style="border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
                                                <div style="padding: 8px; text-align: center; font-weight: bold; font-size: 12px; color: #333; border-bottom: 3px solid ${colors['ë°”ë‹¥2']};">${icons['ë°”ë‹¥2']} ë°”ë‹¥2</div>
                                                <img src="${item.photos['ë°”ë‹¥2']}" style="width: 100%; height: 240px; object-fit: cover; display: block;" />
                                            </div>
                                        </div>`;
                                    } else if (hasFloor1 || hasFloor2) {
                                        const floorPhoto = hasFloor1 ? { name: 'ë°”ë‹¥1', photo: item.photos['ë°”ë‹¥1'], color: colors['ë°”ë‹¥1'], icon: icons['ë°”ë‹¥1'] } 
                                                                      : { name: 'ë°”ë‹¥2', photo: item.photos['ë°”ë‹¥2'], color: colors['ë°”ë‹¥2'], icon: icons['ë°”ë‹¥2'] };
                                        html += `<div style="display: flex; justify-content: center;"><div style="width: 60%; border: 1px solid #ddd; border-radius: 4px; overflow: hidden;">
                                            <div style="padding: 8px; text-align: center; font-weight: bold; font-size: 12px; color: #333; border-bottom: 3px solid ${floorPhoto.color};">${floorPhoto.icon} ${floorPhoto.name}</div>
                                            <img src="${floorPhoto.photo}" style="width: 100%; height: 280px; object-fit: cover; display: block;" />
                                        </div></div>`;
                                    }
                                    return html;
                                })()}
                            </div>
                        ` : `
                            <div style="text-align: center;"><img src="${item.photo || ''}" style="width: 100%; max-height: 350px; object-fit: contain;" /></div>
                        `}
                    </div>
                `;
            });
            return `<div style="width: 794px; min-height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 30px;">
                <div style="background: white; color: #000; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #ddd;">
                    <h2 style="margin: 0; font-size: 20px; font-weight: bold;">ì¥ë¹„ ì¸¡ì • ë³´ê³ ì„œ</h2>
                    <p style="margin: 5px 0 0 0; font-size: 13px; color: #333;">${projectData.apartmentName} ${projectData.dong}ë™ ${projectData.ho}í˜¸ | ${projectData.inspectionDate || ''}</p>
                </div>
                ${contentHTML}
            </div>`;
        }

        // ==================== ë‚˜ë¨¸ì§€ ê¸°ëŠ¥ ë¡œì§ (ìœ ì§€) ====================
        
        // (ë‚˜ë¨¸ì§€ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ê¸°ëŠ¥ë“¤ì€ ìƒëµ ì—†ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
        // ê³µê°„ ì œì•½ìƒ ìœ„ìª½ í•µì‹¬ ë¡œì§ë§Œ ë³€ê²½í–ˆê³ , ë‚˜ë¨¸ì§€ëŠ” ì´ì „ íŒŒì¼ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.)
        // â€» ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” ì´ì „ ë‹µë³€ì˜ ë‚˜ë¨¸ì§€ JavaScript ì½”ë“œë“¤ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ì–´ì•¼ í•©ë‹ˆë‹¤.
        //   ë¡œê·¸ì¸, ì¹´ë©”ë¼, ë°ì´í„° ì €ì¥, ë‹¤ë¥¸ PDF ìƒì„± ë¡œì§ ë“±ë“±... 
        //   ì´ë¯¸ ê°€ì§€ê³  ê³„ì‹  index.htmlì˜ ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„ì„ ê·¸ëŒ€ë¡œ ì“°ì‹œë˜, 
        //   ìœ„ì˜ `createSummaryFirstPage`, `createDefectListPage`, `createDefectDetailPage` í•¨ìˆ˜ë§Œ êµì²´í•˜ë©´ ë©ë‹ˆë‹¤.
        
        // í¸ì˜ë¥¼ ìœ„í•´ ì „ì²´ ì½”ë“œê°€ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”. í˜„ì¬ëŠ” HTML êµ¬ì¡°ì™€ CSS, ê·¸ë¦¬ê³  í•µì‹¬ PDF ìƒì„± í•¨ìˆ˜ë§Œ ì œê³µí–ˆìŠµë‹ˆë‹¤.
    </script>
    
    <script>
        // ... (ì´ì „ íŒŒì¼ì˜ ë‚˜ë¨¸ì§€ ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©ë“¤) ...
        
        // ì›Œí„°ë§ˆí¬ í•¨ìˆ˜
        window.addWatermarkToPhoto = async function(imageDataUrl, text) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width; canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    const badgeHeight = img.height * 0.06; const fontSize = badgeHeight * 0.5;
                    ctx.font = `bold ${fontSize}px Arial`;
                    const textWidth = ctx.measureText(text).width;
                    const badgeWidth = textWidth + badgeHeight * 0.4;
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
                    ctx.roundRect(20, 20, badgeWidth, badgeHeight, 12); ctx.fill();
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)'; ctx.lineWidth = 3;
                    ctx.roundRect(20, 20, badgeWidth, badgeHeight, 12); ctx.stroke();
                    ctx.fillStyle = '#FFFFFF'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(text, 20 + badgeWidth / 2, 20 + badgeHeight / 2);
                    resolve(canvas.toDataURL('image/jpeg', 0.95));
                };
                img.src = imageDataUrl;
            });
        }
        
        // PDF ìƒì„± ìœ í‹¸
        window.addHTMLPageToPDF = async function(doc, htmlContent, pageWidth, pageHeight) {
            const tempDiv = document.createElement('div');
            tempDiv.style.width = '794px'; tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px'; tempDiv.style.background = '#ffffff';
            tempDiv.innerHTML = htmlContent; document.body.appendChild(tempDiv);
            const canvas = await html2canvas(tempDiv, { scale: 2, useCORS: true, backgroundColor: '#ffffff', logging: false });
            document.body.removeChild(tempDiv);
            const imgData = canvas.toDataURL('image/jpeg', 0.95);
            const imgHeight = (canvas.height * pageWidth) / canvas.width;
            doc.addImage(imgData, 'JPEG', 0, 0, pageWidth, Math.min(imgHeight, pageHeight));
        }
        
        // ë¡œê·¸ì¸ ë“± ê¸°ë³¸ ê¸°ëŠ¥ ì´ˆê¸°í™” (ìƒëµëœ ë¶€ë¶„ì€ ì´ì „ ì½”ë“œì™€ ë™ì¼)
        function autoSaveProjectData() {
            projectData.apartmentName = document.getElementById('apartmentName').value;
            projectData.dong = document.getElementById('dong').value;
            projectData.ho = document.getElementById('ho').value;
            projectData.inspectionDate = document.getElementById('inspectionDate').value;
            projectData.customerName = document.getElementById('customerName').value;
            projectData.author = document.getElementById('author').value;
            updateProgress();
        }
        
        function updateProgress() {
             let progress = 0;
             if(projectData.apartmentName) progress+=20;
             if(projectData.floorplan) progress+=15;
             if(projectData.defects && projectData.defects.length > 0) progress+=25;
             if(projectData.equipment && projectData.equipment.length > 0) progress+=20;
             if(projectData.airQuality && projectData.airQuality.length > 0) progress+=20;
             document.getElementById('progressBar').style.width = progress + '%';
        }

        // íƒ­ ì „í™˜ ë“± í•„ìˆ˜ UI ë¡œì§
        window.switchTab = function(tabName, evt) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            if (evt && evt.target) evt.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            const floatingBtn = document.getElementById('floatingAddBtn');
            if (tabName === 'defects' || tabName === 'equipment') floatingBtn.style.display = 'flex';
            else floatingBtn.style.display = 'none';
            updateProgress();
        }
        
        // ë¡œê·¸ì¸, ì¹´ë©”ë¼, ë“±ë“±... (ì´ì „ íŒŒì¼ì˜ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ê°€ ì—¬ê¸°ì— ìˆë‹¤ê³  ê°€ì •)
        // í¸ì˜ìƒ ì´ ë‹µë³€ì—ì„œëŠ” 'ë””ìì¸ ë³€ê²½' ë¶€ë¶„ë§Œ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.
        // ì‹¤ì œë¡œëŠ” ì´ì „ íŒŒì¼ì˜ <script> íƒœê·¸ ë‚´ë¶€ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ì“°ë˜,
        // ìœ„ì— ì •ì˜í•œ createSummaryFirstPage, createDefectListPage, createDefectDetailPage 3ê°œ í•¨ìˆ˜ë§Œ êµì²´í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
    </script>
</body>
</html>