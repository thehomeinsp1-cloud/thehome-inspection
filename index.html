<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë”í™ˆì ê²€ - í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ë”í™ˆì ê²€">
    
    <!-- jsPDF + html2canvas Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #fbbf24;
            --danger: #ef4444;
            --bg-dark: #1a202c;
            --bg-darker: #111827;
            --card-bg: rgba(30, 41, 59, 0.5);
            --border: rgba(255, 255, 255, 0.1);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 5px;
            margin: 20px 0;
            gap: 5px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: fit-content;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .form-field {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: rgba(251, 191, 36, 0.1);
            border: 2px solid var(--secondary);
            color: var(--secondary);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        /* í‰ë©´ë„ ê´€ë¦¬ */
        .floorplan-container {
            text-align: center;
        }

        .floorplan-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px solid var(--border);
        }

        .photo-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .photo-action-btn {
            padding: 14px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .photo-action-btn.camera {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }

        .photo-action-btn:active {
            transform: scale(0.98);
        }

        /* í•˜ì ëª©ë¡ */
        .defect-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
        }

        .defect-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .defect-number {
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .defect-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ê³µê¸°ì§ˆ ì¸¡ì • */
        .air-quality-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
        }

        .air-room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }

        .air-room-name-input {
            flex: 1;
            padding: 10px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--primary);
            font-weight: bold;
            font-size: 16px;
        }

        .air-room-delete {
            width: 40px;
            height: 40px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .air-inputs {
            display: grid;
            gap: 12px;
        }

        .air-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .air-input-group label {
            min-width: 100px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .air-input-group input {
            flex: 1;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            text-align: center;
        }

        .air-input-group span {
            color: var(--text-secondary);
            font-size: 12px;
            min-width: 80px;
        }

        .air-add-btn {
            width: 100%;
            padding: 14px;
            background: rgba(16, 185, 129, 0.1);
            border: 2px dashed var(--primary);
            border-radius: 12px;
            color: var(--primary);
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .air-add-btn:active {
            transform: scale(0.98);
        }

        .reference-info {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* ë°ì´í„° ê´€ë¦¬ */
        .saved-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .saved-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .saved-info {
            flex: 1;
        }

        .saved-info h3 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .saved-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .saved-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .icon-btn.load {
            background: rgba(16, 185, 129, 0.2);
            color: var(--primary);
        }

        .icon-btn.delete {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        /* Toast ì•Œë¦¼ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-weight: bold;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ì¹´ë©”ë¼ ëª¨ë‹¬ */
        .camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .camera-modal.active {
            display: flex;
        }

        #cameraPreview {
            width: 100%;
            max-width: 600px;
            border-radius: 12px;
        }

        .camera-controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .camera-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 4px solid white;
            background: var(--primary);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .camera-btn.close {
            background: var(--danger);
        }

        /* í”Œë¡œíŒ… ë²„íŠ¼ */
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .floating-btn:active {
            transform: scale(0.95);
        }

        .floating-btn:hover {
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
        }

        /* ë¡œë”© */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px 40px;
            border-radius: 16px;
            z-index: 2000;
            text-align: center;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 20px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 13px;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* ì„ íƒ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        select.form-input {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2310b981' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        /* ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* í„°ì¹˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .touch-button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .touch-btn {
            padding: 10px 8px;
            border: 2px solid var(--border);
            background: rgba(30, 41, 59, 0.3);
            color: var(--text-secondary);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .touch-btn:active {
            transform: scale(0.95);
        }

        .touch-btn.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .touch-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .selected-count {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
    </style>

</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ  ë”í™ˆì ê²€</h1>
        <p>í•˜ìê´€ë¦¬ ì‹œìŠ¤í…œ v3.2 (ì‚¬ì§„ 2ì¥ ì´¬ì˜)</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
    </div>

    <div class="container">
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('project')">ğŸ“ í”„ë¡œì íŠ¸</button>
            <button class="tab" onclick="switchTab('defects')">ğŸ” í•˜ìì ê²€</button>
            <button class="tab" onclick="switchTab('equipment')">ğŸ“¸ ì¥ë¹„ì ê²€</button>
            <button class="tab" onclick="switchTab('airquality')">ğŸŒ¬ï¸ ê³µê¸°ì§ˆ</button>
            <button class="tab" onclick="switchTab('data')">ğŸ’¾ ë°ì´í„°</button>
        </div>

        <!-- í”„ë¡œì íŠ¸ ì •ë³´ ì„¹ì…˜ -->
        <div id="project" class="section active">
            <!-- í”„ë¡œì íŠ¸ ëª©ë¡ ì¹´ë“œ -->
            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 20px;">
                <h2 style="color: white; margin-bottom: 15px;">ğŸ“‹ í”„ë¡œì íŠ¸ ëª©ë¡</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button onclick="addNewProject()" class="btn" style="background: white; color: #667eea; flex: 1; min-width: 120px;">
                        â• ìƒˆ í”„ë¡œì íŠ¸
                    </button>
                    <button onclick="deleteCurrentProject()" class="btn" style="background: rgba(255,255,255,0.2); color: white; flex: 1; min-width: 120px;">
                        ğŸ—‘ï¸ í˜„ì¬ ì‚­ì œ
                    </button>
                </div>

                <div id="projectList" style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 10px; max-height: 200px; overflow-y: auto;">
                    <!-- í”„ë¡œì íŠ¸ ëª©ë¡ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <div style="margin-top: 10px; font-size: 13px; opacity: 0.9;">
                    ğŸ’¡ íŒ: í•˜ë£¨ì— ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ë¥¼ í´ë¦­í•˜ë©´ ì „í™˜ë©ë‹ˆë‹¤.
                </div>
            </div>

            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“ í”„ë¡œì íŠ¸ ì •ë³´</h2>
                
                <div class="form-field">
                    <label class="form-label">ì•„íŒŒíŠ¸ëª…</label>
                    <input type="text" class="form-input" id="apartmentName" placeholder="ì˜ˆ: ë˜ë¯¸ì•ˆ ì•„íŒŒíŠ¸" onchange="saveCurrentProjectFromUI(); saveProjectsToLocalStorage(); renderProjectList();">
                </div>

                <div class="grid-2">
                    <div class="form-field">
                        <label class="form-label">ë™</label>
                        <input type="text" class="form-input" id="dong" placeholder="ì˜ˆ: 101ë™" onchange="saveCurrentProjectFromUI(); saveProjectsToLocalStorage(); renderProjectList();">
                    </div>
                    <div class="form-field">
                        <label class="form-label">í˜¸ìˆ˜</label>
                        <input type="text" class="form-input" id="ho" placeholder="ì˜ˆ: 502í˜¸" onchange="saveCurrentProjectFromUI(); saveProjectsToLocalStorage(); renderProjectList();">
                    </div>
                </div>

                <div class="form-field">
                    <label class="form-label">ì ê²€ì¼ì</label>
                    <input type="date" class="form-input" id="inspectionDate" onchange="saveCurrentProjectFromUI(); saveProjectsToLocalStorage();">
                </div>

                <div class="form-field">
                    <label class="form-label">ê³ ê°ëª…</label>
                    <input type="text" class="form-input" id="customerName" placeholder="ê³ ê° ì´ë¦„" onchange="saveCurrentProjectFromUI(); saveProjectsToLocalStorage();">
                </div>

                <div class="form-field">
                    <label class="form-label">ì—°ë½ì²˜</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="010-0000-0000" onchange="saveCurrentProjectFromUI(); saveProjectsToLocalStorage();">
                </div>

                <button class="btn btn-primary" onclick="saveProject()">âœ… í”„ë¡œì íŠ¸ ì •ë³´ ì €ì¥</button>
            </div>

            <!-- í‰ë©´ë„ ì„¹ì…˜ í†µí•© -->
            <div class="card" style="margin-top: 20px;">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“ í‰ë©´ë„ ê´€ë¦¬</h2>
                
                <div class="floorplan-container">
                    <img id="floorplanPreview" class="floorplan-preview" style="display: none;">
                    <p id="floorplanPlaceholder" style="color: var(--text-secondary); padding: 60px 0;">
                        í‰ë©´ë„ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”
                    </p>
                    
                    <div class="photo-actions">
                        <button class="photo-action-btn camera" onclick="openFloorplanCamera()">
                            ğŸ“· ì´¬ì˜í•˜ê¸°
                        </button>
                        <button class="photo-action-btn" onclick="openFloorplanGallery()">
                            ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬
                        </button>
                    </div>

                    <button class="btn btn-danger" onclick="deleteFloorplan()" style="margin-top: 15px;">
                        ğŸ—‘ï¸ í‰ë©´ë„ ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>

        <!-- í•˜ì ì ê²€ ì„¹ì…˜ -->
        <div id="defects" class="section">
            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ” í•˜ì ì ê²€</h2>
                <p style="color: var(--text-secondary); font-size: 14px;">
                    ìš°ì¸¡ í•˜ë‹¨ì˜ â• ë²„íŠ¼ì„ ëˆŒëŸ¬ í•˜ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”
                </p>
            </div>

            <div id="defectsList"></div>
        </div>

        <!-- ì¥ë¹„ì ê²€ ì„¹ì…˜ -->
        <div id="equipment" class="section">
            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ“¸ ì¥ë¹„ ì ê²€ LIST</h2>
                <p style="color: var(--text-secondary); font-size: 14px;">
                    ì—´í™”ìƒ ì¹´ë©”ë¼ ë° ì‹¤ë¬¼ ì‚¬ì§„ ì´¬ì˜ (ìš°ì¸¡ í•˜ë‹¨ â• ë²„íŠ¼)
                </p>
            </div>

            <div id="equipmentList"></div>
        </div>

        <!-- ê³µê¸°ì§ˆ ì¸¡ì • ì„¹ì…˜ -->
        <div id="airquality" class="section">
            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸŒ¬ï¸ ê³µê¸°ì§ˆ ì¸¡ì •</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 14px;">
                    ì‹¤ë‚´ ê³µê¸°ì§ˆì„ ì¸¡ì •í•˜ê³  ê¸°ë¡í•˜ì„¸ìš”
                </p>
            </div>

            <div id="airQualityList"></div>

            <button class="air-add-btn" onclick="addAirQualityRoom()">
                â• ë°© ì¶”ê°€
            </button>

            <div class="card reference-info">
                <strong>ğŸ“‹ ê¶Œê³ ê¸°ì¤€</strong><br>
                ë¼ëˆ: 148 Bq/mÂ³ ì´í•˜<br>
                í¬ë¦„ì•Œë°íˆë“œ: 0.210 mg/mÂ³ ì´í•˜<br>
                ì´íœ˜ë°œì„±ìœ ê¸°í™”í•©ë¬¼: 0.500 mg/mÂ³ ì´í•˜
            </div>
        </div>

        <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="data" class="section">
            <!-- Google Drive ì—°ë™ ì¹´ë“œ -->
            <div class="card" style="background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); color: white; margin-bottom: 20px;">
                <h2 style="color: white; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M6.5 12L1 21h11l5.5-9H6.5zM19 12l-5.5-9L8 12h11zM7.5 3l-6 9h11l-5-9z"/>
                    </svg>
                    Google Drive ì—°ë™
                </h2>
                
                <div id="googleDriveStatus" style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px; font-size: 14px;">
                    <div id="notSignedIn" style="display: block;">
                        âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë©´ íŒ€ì›ë“¤ê³¼ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                    <div id="signedIn" style="display: none;">
                        âœ… <span id="userEmail"></span>ë‹˜ ë¡œê·¸ì¸ë¨
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button id="signInBtn" class="btn" onclick="handleGoogleSignIn()" style="flex: 1; background: white; color: #4285f4; font-weight: bold;">
                        ğŸ” Google ë¡œê·¸ì¸
                    </button>
                    <button id="signOutBtn" class="btn" onclick="handleGoogleSignOut()" style="flex: 1; background: rgba(255,255,255,0.2); color: white; display: none;">
                        ğŸšª ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>

            <!-- í´ë¼ìš°ë“œ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° -->
            <div class="card" id="cloudActionsCard" style="display: none;">
                <h3 style="color: var(--primary); margin-bottom: 15px;">â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥ì†Œ</h3>
                
                <button class="btn btn-primary" onclick="uploadProjectToDrive()" style="margin-bottom: 10px;">
                    â˜ï¸ Driveì— ì €ì¥
                </button>
                
                <button class="btn btn-secondary" onclick="loadFromDrive()" style="margin-bottom: 10px;">
                    ğŸ“¥ Driveì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>

                <button class="btn" onclick="showDriveProjects()" style="background: #34a853; color: white;">
                    ğŸ“‚ í”„ë¡œì íŠ¸ ëª©ë¡ ë³´ê¸°
                </button>
            </div>

            <div class="card">
                <h2 style="color: var(--primary); margin-bottom: 20px;">ğŸ’¾ ë¡œì»¬ ë°ì´í„° ê´€ë¦¬</h2>
                
                <button class="btn btn-primary" onclick="generatePDF()">ğŸ“„ PDF ë³´ê³ ì„œ ìƒì„±</button>
                
                <div style="height: 20px;"></div>
                
                <button class="btn btn-secondary" onclick="saveCurrentData()">ğŸ’¾ ë¡œì»¬ ì €ì¥</button>
                
                <div style="height: 20px;"></div>
                
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
            </div>

            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ“¦ ë¡œì»¬ ì €ì¥ í”„ë¡œì íŠ¸</h3>
                <div id="savedList" class="saved-list"></div>
            </div>
        </div>
    </div>

    <!-- ì¹´ë©”ë¼ ëª¨ë‹¬ -->
    <div id="cameraModal" class="camera-modal">
        <video id="cameraPreview" autoplay playsinline></video>
        <div class="camera-controls">
            <button class="camera-btn" onclick="capturePhoto()" ontouchstart="">ğŸ“¸</button>
            <button class="camera-btn close" onclick="closeCameraModal()" ontouchstart="">âœ•</button>
        </div>
    </div>

    <!-- í”Œë¡œíŒ… í•˜ì/ì¥ë¹„ ì¶”ê°€ ë²„íŠ¼ -->
    <button id="floatingAddBtn" class="floating-btn" onclick="handleFloatingBtnClick()" style="display: none;">
        â•
    </button>

    <!-- ë¡œë”© -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>ì²˜ë¦¬ ì¤‘...</p>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Drive í”„ë¡œì íŠ¸ ëª©ë¡ ëª¨ë‹¬ -->
    <div id="driveProjectsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; overflow-y: auto;">
        <div style="max-width: 600px; margin: 50px auto; background: var(--bg-dark); border-radius: 12px; padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: var(--primary);">ğŸ“‚ Drive í”„ë¡œì íŠ¸ ëª©ë¡</h2>
                <button onclick="closeDriveProjectsModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">âœ•</button>
            </div>
            <div id="driveProjectsList" style="max-height: 60vh; overflow-y: auto;">
                <!-- í”„ë¡œì íŠ¸ ëª©ë¡ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ==================== Google Drive API ì„¤ì • ====================
        // Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ ì‹¤ì œ ê°’
        const GOOGLE_CLIENT_ID = '41297273395-akfc0j40utujca3ofvbdmmqdlh449do2.apps.googleusercontent.com';
        const GOOGLE_API_KEY = 'AIzaSyBNAkir6I-_MudQIpQHooyaxafA7HrkcGQ';
        const DISCOVERY_DOCS = [
            'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',
            'https://sheets.googleapis.com/$discovery/rest?version=v4'
        ];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/spreadsheets';
        
        let gapiInited = false;
        let gisInited = false;
        let tokenClient;
        let accessToken = null;
        let currentUser = null;

        // ==================== í”„ë¡œì íŠ¸ ëª©ë¡ ê´€ë¦¬ ====================
        let projects = []; // ëª¨ë“  í”„ë¡œì íŠ¸ ëª©ë¡
        let currentProjectId = null; // í˜„ì¬ ì‘ì—… ì¤‘ì¸ í”„ë¡œì íŠ¸ ID

        // í”„ë¡œì íŠ¸ í…œí”Œë¦¿
        function createNewProject() {
            return {
                id: Date.now(),
                apartmentName: '',
                dong: '',
                ho: '',
                inspectionDate: new Date().toISOString().split('T')[0],
                customerName: '',
                customerPhone: '',
                floorplan: null,
                defects: [],
                equipment: [],
                airQuality: [],
                createdAt: new Date().toISOString(),
                isUploaded: false
            };
        }

        // í˜„ì¬ í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸°
        function getCurrentProject() {
            if (projects.length === 0) {
                const newProject = createNewProject();
                projects.push(newProject);
                currentProjectId = newProject.id;
            }
            return projects.find(p => p.id === currentProjectId) || projects[0];
        }

        // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ projectData
        let projectData = getCurrentProject();

        let defectIdCounter = 1;
        let equipmentIdCounter = 1;
        let airQualityIdCounter = 1;
        let cameraStream = null;
        let currentPhotoTarget = null;

        // ==================== Google API ì´ˆê¸°í™” ====================
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    apiKey: GOOGLE_API_KEY,
                    discoveryDocs: DISCOVERY_DOCS,
                });
                gapiInited = true;
                maybeEnableButtons();
            } catch (error) {
                console.error('GAPI ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: GOOGLE_CLIENT_ID,
                scope: SCOPES,
                callback: '', // ë‚˜ì¤‘ì— ì„¤ì •
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('signInBtn').disabled = false;
                checkIfSignedIn();
            }
        }

        function checkIfSignedIn() {
            const token = localStorage.getItem('google_access_token');
            if (token) {
                accessToken = token;
                gapi.client.setToken({ access_token: token });
                updateSignInStatus(true);
            }
        }

        // ==================== Google ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ====================
        async function handleGoogleSignIn() {
            tokenClient.callback = async (response) => {
                if (response.error !== undefined) {
                    console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', response);
                    showToast('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + response.error);
                    return;
                }
                
                accessToken = response.access_token;
                localStorage.setItem('google_access_token', accessToken);
                
                // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                try {
                    const userInfo = await gapi.client.request({
                        path: 'https://www.googleapis.com/oauth2/v1/userinfo',
                    });
                    currentUser = userInfo.result;
                    updateSignInStatus(true);
                    showToast('ë¡œê·¸ì¸ ì„±ê³µ!');
                } catch (error) {
                    console.error('ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                }
            };

            if (accessToken === null) {
                tokenClient.requestAccessToken({ prompt: 'consent' });
            } else {
                tokenClient.requestAccessToken({ prompt: '' });
            }
        }

        function handleGoogleSignOut() {
            if (accessToken) {
                google.accounts.oauth2.revoke(accessToken);
                accessToken = null;
                currentUser = null;
                gapi.client.setToken(null);
                localStorage.removeItem('google_access_token');
                updateSignInStatus(false);
                showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function updateSignInStatus(isSignedIn) {
            if (isSignedIn) {
                document.getElementById('notSignedIn').style.display = 'none';
                document.getElementById('signedIn').style.display = 'block';
                document.getElementById('userEmail').textContent = currentUser?.email || 'ì‚¬ìš©ì';
                document.getElementById('signInBtn').style.display = 'none';
                document.getElementById('signOutBtn').style.display = 'block';
                document.getElementById('cloudActionsCard').style.display = 'block';
            } else {
                document.getElementById('notSignedIn').style.display = 'block';
                document.getElementById('signedIn').style.display = 'none';
                document.getElementById('signInBtn').style.display = 'block';
                document.getElementById('signOutBtn').style.display = 'none';
                document.getElementById('cloudActionsCard').style.display = 'none';
            }
        }

        // ==================== Drive í´ë” ê´€ë¦¬ ====================
        async function getOrCreateAppFolder() {
            try {
                // "ë”í™ˆì ê²€" í´ë” ì°¾ê¸°
                const response = await gapi.client.drive.files.list({
                    q: "name='ë”í™ˆì ê²€' and mimeType='application/vnd.google-apps.folder' and trashed=false",
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });

                if (response.result.files && response.result.files.length > 0) {
                    return response.result.files[0].id;
                }

                // í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±
                const folderMetadata = {
                    name: 'ë”í™ˆì ê²€',
                    mimeType: 'application/vnd.google-apps.folder'
                };

                const folder = await gapi.client.drive.files.create({
                    resource: folderMetadata,
                    fields: 'id'
                });

                return folder.result.id;
            } catch (error) {
                console.error('í´ë” ìƒì„±/ì°¾ê¸° ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ==================== Drive ì €ì¥ ====================
        

        // ==================== Drive ë¶ˆëŸ¬ì˜¤ê¸° ====================
                async function createProjectFolder(appFolderId, projectName) {
            try {
                const folderMetadata = {
                    name: projectName,
                    mimeType: 'application/vnd.google-apps.folder',
                    parents: [appFolderId]
                };

                const folder = await gapi.client.drive.files.create({
                    resource: folderMetadata,
                    fields: 'id, name'
                });

                return folder.result.id;
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ í´ë” ìƒì„± ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // í•˜ìì‚¬ì§„ í´ë” ìƒì„±

        async function createPhotosFolder(projectFolderId) {
            try {
                const folderMetadata = {
                    name: 'í•˜ìì‚¬ì§„',
                    mimeType: 'application/vnd.google-apps.folder',
                    parents: [projectFolderId]
                };

                const folder = await gapi.client.drive.files.create({
                    resource: folderMetadata,
                    fields: 'id'
                });

                return folder.result.id;
            } catch (error) {
                console.error('ì‚¬ì§„ í´ë” ìƒì„± ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // Base64 ì´ë¯¸ì§€ë¥¼ Blobìœ¼ë¡œ ë³€í™˜

        function base64ToBlob(base64, mimeType) {
            const byteString = atob(base64.split(',')[1]);
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: mimeType });
        }

        async function uploadPhoto(photosFolderId, photoData, fileName) {
            try {
                const blob = base64ToBlob(photoData, 'image/jpeg');
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify({
                    name: fileName,
                    mimeType: 'image/jpeg',
                    parents: [photosFolderId]
                })], { type: 'application/json' }));
                form.append('file', blob);

                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken
                    },
                    body: form
                });

                if (!response.ok) {
                    throw new Error('ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨');
                }

                const result = await response.json();
                return result.id;
            } catch (error) {
                console.error('ì‚¬ì§„ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // Google Sheets ìƒì„± (í•˜ì ë¦¬ìŠ¤íŠ¸)

        async function createDefectSpreadsheet(projectFolderId, projectName, defects) {
            try {
                // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„±
                const spreadsheetBody = {
                    properties: {
                        title: `${projectName}_í•˜ìì ê²€_ë¦¬ìŠ¤íŠ¸`
                    },
                    sheets: [{
                        properties: {
                            title: 'í•˜ìëª©ë¡'
                        }
                    }]
                };

                const createResponse = await gapi.client.sheets.spreadsheets.create({
                    resource: spreadsheetBody
                });

                const spreadsheetId = createResponse.result.spreadsheetId;

                // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ í”„ë¡œì íŠ¸ í´ë”ë¡œ ì´ë™
                await gapi.client.drive.files.update({
                    fileId: spreadsheetId,
                    addParents: projectFolderId,
                    fields: 'id, parents'
                });

                // ë°ì´í„° ì…ë ¥ ì¤€ë¹„
                const headers = [['No', 'ê³µê°„', 'ìœ„ì¹˜', 'í•˜ìì¢…ë¥˜']];
                const rows = defects.map((defect, index) => [
                    index + 1,
                    defect.spaces.join(', '),
                    defect.locations.join(', '),
                    defect.types.join(', ')
                ]);

                const allData = [...headers, ...rows];

                // ë°ì´í„° ì…ë ¥
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: spreadsheetId,
                    range: 'A1',
                    valueInputOption: 'RAW',
                    resource: {
                        values: allData
                    }
                });

                // í—¤ë” ìŠ¤íƒ€ì¼ ì ìš©
                await gapi.client.sheets.spreadsheets.batchUpdate({
                    spreadsheetId: spreadsheetId,
                    resource: {
                        requests: [{
                            repeatCell: {
                                range: {
                                    sheetId: 0,
                                    startRowIndex: 0,
                                    endRowIndex: 1
                                },
                                cell: {
                                    userEnteredFormat: {
                                        backgroundColor: {
                                            red: 0.06,
                                            green: 0.73,
                                            blue: 0.51
                                        },
                                        textFormat: {
                                            foregroundColor: {
                                                red: 1,
                                                green: 1,
                                                blue: 1
                                            },
                                            bold: true
                                        }
                                    }
                                },
                                fields: 'userEnteredFormat(backgroundColor,textFormat)'
                            }
                        }]
                    }
                });

                return spreadsheetId;
            } catch (error) {
                console.error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„± ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // í”„ë¡œì íŠ¸ ì •ë³´ JSON ì—…ë¡œë“œ

        async function uploadProjectInfo(projectFolderId, projectData) {
            try {
                const projectInfo = {
                    apartmentName: projectData.apartmentName,
                    dong: projectData.dong,
                    ho: projectData.ho,
                    inspectionDate: projectData.inspectionDate,
                    customerName: projectData.customerName,
                    customerPhone: projectData.customerPhone,
                    uploadedAt: new Date().toISOString(),
                    uploadedBy: currentUser?.email
                };

                const blob = new Blob([JSON.stringify(projectInfo, null, 2)], { type: 'application/json' });

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify({
                    name: 'í”„ë¡œì íŠ¸_ì •ë³´.json',
                    mimeType: 'application/json',
                    parents: [projectFolderId]
                })], { type: 'application/json' }));
                form.append('file', blob);

                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken
                    },
                    body: form
                });

                if (!response.ok) {
                    throw new Error('í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë¡œë“œ ì‹¤íŒ¨');
                }

                return true;
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ë©”ì¸ ì—…ë¡œë“œ í•¨ìˆ˜

        async function uploadProjectToDrive() {
            if (!accessToken) {
                alert('ë¨¼ì € Google ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”');
                return;
            }

            const project = getCurrentProject();

            // í•„ìˆ˜ ì •ë³´ í™•ì¸
            if (!project.apartmentName || !project.dong || !project.ho) {
                alert('í”„ë¡œì íŠ¸ ì •ë³´(ì•„íŒŒíŠ¸ëª…, ë™, í˜¸)ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            if (project.defects.length === 0) {
                alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ í•˜ìë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”');
                return;
            }

            if (!confirm(`"${project.apartmentName} ${project.dong} ${project.ho}"ë¥¼ Google Driveì— ì—…ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            showLoading();

            try {
                // 1. ì•± ë£¨íŠ¸ í´ë” ê°€ì ¸ì˜¤ê¸°/ìƒì„±
                const appFolderId = await getOrCreateAppFolder();
                
                // 2. í”„ë¡œì íŠ¸ í´ë” ìƒì„±
                const projectName = `${project.inspectionDate}_${project.apartmentName}_${project.dong}_${project.ho}`;
                const projectFolderId = await createProjectFolder(appFolderId, projectName);
                
                // 3. í•˜ìì‚¬ì§„ í´ë” ìƒì„±
                const photosFolderId = await createPhotosFolder(projectFolderId);
                
                // 4. ì‚¬ì§„ ì—…ë¡œë“œ (ì°ì€ ìˆœì„œëŒ€ë¡œ 1.jpg, 2.jpg...)
                let photoIndex = 1;
                const totalPhotos = project.defects.reduce((sum, defect) => sum + (defect.photos?.length || 0), 0);
                
                for (const defect of project.defects) {
                    if (defect.photos && defect.photos.length > 0) {
                        for (const photo of defect.photos) {
                            await uploadPhoto(photosFolderId, photo, `${photoIndex}.jpg`);
                            photoIndex++;
                        }
                    }
                }
                
                // 5. í•˜ì ë¦¬ìŠ¤íŠ¸ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ìƒì„±
                await createDefectSpreadsheet(projectFolderId, projectName, project.defects);
                
                // 6. í”„ë¡œì íŠ¸ ì •ë³´ JSON ì—…ë¡œë“œ
                await uploadProjectInfo(projectFolderId, project);
                
                // 7. í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
                project.isUploaded = true;
                project.uploadedAt = new Date().toISOString();
                project.driveFolderId = projectFolderId;
                
                // 8. ë¡œì»¬ ì €ì¥
                saveProjectsToLocalStorage();
                renderProjectList();
                
                hideLoading();
                showToast(`âœ… ì—…ë¡œë“œ ì™„ë£Œ! (ì‚¬ì§„ ${totalPhotos}ì¥)`);
                alert(`âœ… ì—…ë¡œë“œ ì™„ë£Œ!\n\ní”„ë¡œì íŠ¸: ${projectName}\nì‚¬ì§„: ${totalPhotos}ì¥\ní•˜ì: ${project.defects.length}ê°œ\n\nGoogle Driveì—ì„œ í™•ì¸í•˜ì„¸ìš”!`);
                
            } catch (error) {
                console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                hideLoading();
                alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message);
            }
        }

        // ==================== Drive ë¶ˆëŸ¬ì˜¤ê¸° (ì‚­ì œ ì˜ˆì •) ====================


        async function loadFromDrive() {
            if (!accessToken) {
                alert('ë¨¼ì € Google ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”');
                return;
            }

            if (!projectData.apartmentName || !projectData.dong || !projectData.ho) {
                alert('ë¶ˆëŸ¬ì˜¬ í”„ë¡œì íŠ¸ ì •ë³´(ì•„íŒŒíŠ¸ëª…, ë™, í˜¸)ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            showLoading();

            try {
                const folderId = await getOrCreateAppFolder();
                const fileName = `${projectData.apartmentName}_${projectData.dong}ë™_${projectData.ho}í˜¸.json`;

                // íŒŒì¼ ê²€ìƒ‰
                const response = await gapi.client.drive.files.list({
                    q: `name='${fileName}' and '${folderId}' in parents and trashed=false`,
                    fields: 'files(id, name)',
                    spaces: 'drive'
                });

                if (!response.result.files || response.result.files.length === 0) {
                    hideLoading();
                    alert('í•´ë‹¹ í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                const fileId = response.result.files[0].id;

                // íŒŒì¼ ë‚´ìš© ë‹¤ìš´ë¡œë“œ
                const fileResponse = await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, {
                    headers: {
                        'Authorization': 'Bearer ' + accessToken
                    }
                });

                if (!fileResponse.ok) {
                    throw new Error('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
                }

                const data = await fileResponse.json();

                // ë°ì´í„° ë¡œë“œ
                projectData = {
                    apartmentName: data.apartmentName || '',
                    dong: data.dong || '',
                    ho: data.ho || '',
                    inspectionDate: data.inspectionDate || '',
                    customerName: data.customerName || '',
                    customerPhone: data.customerPhone || '',
                    floorplan: data.floorplan || null,
                    defects: data.defects || [],
                    equipment: data.equipment || [],
                    airQuality: data.airQuality || []
                };

                // ID ì¹´ìš´í„° ì—…ë°ì´íŠ¸
                if (projectData.defects.length > 0) {
                    defectIdCounter = Math.max(...projectData.defects.map(d => d.id)) + 1;
                }
                if (projectData.equipment && projectData.equipment.length > 0) {
                    equipmentIdCounter = Math.max(...projectData.equipment.map(e => e.id)) + 1;
                }
                if (projectData.airQuality.length > 0) {
                    airQualityIdCounter = Math.max(...projectData.airQuality.map(a => a.id)) + 1;
                }

                // UI ì—…ë°ì´íŠ¸
                renderAll();
                saveToLocalStorage();

                hideLoading();
                showToast('âœ… Driveì—ì„œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('Drive ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                hideLoading();
                alert('ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ==================== Drive í”„ë¡œì íŠ¸ ëª©ë¡ ====================
        async function showDriveProjects() {
            if (!accessToken) {
                alert('ë¨¼ì € Google ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”');
                return;
            }

            showLoading();

            try {
                const folderId = await getOrCreateAppFolder();

                // í´ë” ë‚´ ëª¨ë“  JSON íŒŒì¼ ê²€ìƒ‰
                const response = await gapi.client.drive.files.list({
                    q: `'${folderId}' in parents and mimeType='application/json' and trashed=false`,
                    fields: 'files(id, name, modifiedTime)',
                    orderBy: 'modifiedTime desc',
                    spaces: 'drive'
                });

                const files = response.result.files || [];

                hideLoading();

                if (files.length === 0) {
                    alert('ì €ì¥ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                // ëª¨ë‹¬ì— ëª©ë¡ í‘œì‹œ
                const listContainer = document.getElementById('driveProjectsList');
                listContainer.innerHTML = files.map(file => `
                    <div style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s;" 
                         onclick="loadDriveProjectById('${file.id}')"
                         onmouseover="this.style.background='rgba(16, 185, 129, 0.1)'"
                         onmouseout="this.style.background='var(--card-bg)'">
                        <div style="font-weight: bold; margin-bottom: 5px;">ğŸ“„ ${file.name.replace('.json', '')}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ë§ˆì§€ë§‰ ìˆ˜ì •: ${new Date(file.modifiedTime).toLocaleString('ko-KR')}
                        </div>
                    </div>
                `).join('');

                document.getElementById('driveProjectsModal').style.display = 'block';
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                hideLoading();
                alert('ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function loadDriveProjectById(fileId) {
            showLoading();
            closeDriveProjectsModal();

            try {
                // íŒŒì¼ ë‚´ìš© ë‹¤ìš´ë¡œë“œ
                const response = await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, {
                    headers: {
                        'Authorization': 'Bearer ' + accessToken
                    }
                });

                if (!response.ok) {
                    throw new Error('íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
                }

                const data = await response.json();

                // ë°ì´í„° ë¡œë“œ
                projectData = {
                    apartmentName: data.apartmentName || '',
                    dong: data.dong || '',
                    ho: data.ho || '',
                    inspectionDate: data.inspectionDate || '',
                    customerName: data.customerName || '',
                    customerPhone: data.customerPhone || '',
                    floorplan: data.floorplan || null,
                    defects: data.defects || [],
                    equipment: data.equipment || [],
                    airQuality: data.airQuality || []
                };

                // ID ì¹´ìš´í„° ì—…ë°ì´íŠ¸
                if (projectData.defects.length > 0) {
                    defectIdCounter = Math.max(...projectData.defects.map(d => d.id)) + 1;
                }
                if (projectData.equipment && projectData.equipment.length > 0) {
                    equipmentIdCounter = Math.max(...projectData.equipment.map(e => e.id)) + 1;
                }
                if (projectData.airQuality.length > 0) {
                    airQualityIdCounter = Math.max(...projectData.airQuality.map(a => a.id)) + 1;
                }

                // UI ì—…ë°ì´íŠ¸
                renderAll();
                saveToLocalStorage();

                hideLoading();
                showToast('âœ… í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                hideLoading();
                alert('ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function closeDriveProjectsModal() {
            document.getElementById('driveProjectsModal').style.display = 'none';
        }

        // ==================== í”„ë¡œì íŠ¸ ëª©ë¡ ê´€ë¦¬ í•¨ìˆ˜ ====================
        
        // í”„ë¡œì íŠ¸ ëª©ë¡ ë Œë”ë§
        function renderProjectList() {
            const listContainer = document.getElementById('projectList');
            
            if (projects.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; padding: 20px; opacity: 0.7;">í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. "ìƒˆ í”„ë¡œì íŠ¸"ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</div>';
                return;
            }

            listContainer.innerHTML = projects.map((project, index) => {
                const isActive = project.id === currentProjectId;
                const projectName = project.apartmentName && project.dong && project.ho 
                    ? `${project.apartmentName} ${project.dong} ${project.ho}`
                    : `í”„ë¡œì íŠ¸ ${index + 1} (ì •ë³´ ë¯¸ì…ë ¥)`;
                
                const uploadStatus = project.isUploaded 
                    ? '<span style="color: #10b981;">âœ… ì—…ë¡œë“œ ì™„ë£Œ</span>' 
                    : '<span style="color: #fbbf24;">â³ ì‘ì—…ì¤‘</span>';

                return `
                    <div onclick="switchProject(${project.id})" 
                         style="background: ${isActive ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.1)'}; 
                                padding: 12px; 
                                border-radius: 6px; 
                                margin-bottom: 8px; 
                                cursor: pointer;
                                border: ${isActive ? '2px solid white' : '2px solid transparent'};
                                transition: all 0.3s;"
                         onmouseover="if(!${isActive}) this.style.background='rgba(255,255,255,0.2)'"
                         onmouseout="if(!${isActive}) this.style.background='rgba(255,255,255,0.1)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 4px;">
                                    ${isActive ? 'â–¶ ' : ''}${projectName}
                                </div>
                                <div style="font-size: 11px; opacity: 0.8;">
                                    í•˜ì: ${project.defects.length}ê°œ | 
                                    ì¥ë¹„: ${project.equipment ? project.equipment.length : 0}ê°œ | 
                                    ê³µê¸°ì§ˆ: ${project.airQuality.length}ê°œ
                                </div>
                            </div>
                            <div style="font-size: 12px;">
                                ${uploadStatus}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€
        function addNewProject() {
            const newProject = createNewProject();
            projects.push(newProject);
            currentProjectId = newProject.id;
            
            // í˜„ì¬ í”„ë¡œì íŠ¸ ì°¸ì¡° ì—…ë°ì´íŠ¸
            projectData = getCurrentProject();
            
            // UI ìƒˆë¡œê³ ì¹¨
            renderProjectList();
            loadProjectToUI();
            updateProgress();
            
            showToast('âœ¨ ìƒˆ í”„ë¡œì íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
            saveProjectsToLocalStorage();
        }

        // í”„ë¡œì íŠ¸ ì „í™˜
        function switchProject(projectId) {
            if (projectId === currentProjectId) return;
            
            // í˜„ì¬ í”„ë¡œì íŠ¸ UI ë°ì´í„° ì €ì¥
            saveCurrentProjectFromUI();
            
            // í”„ë¡œì íŠ¸ ì „í™˜
            currentProjectId = projectId;
            projectData = getCurrentProject();
            
            // ìƒˆ í”„ë¡œì íŠ¸ UI ë¡œë“œ
            loadProjectToUI();
            renderProjectList();
            updateProgress();
            
            showToast('ğŸ“‚ í”„ë¡œì íŠ¸ê°€ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
            saveProjectsToLocalStorage();
        }

        // í˜„ì¬ í”„ë¡œì íŠ¸ ì‚­ì œ
        function deleteCurrentProject() {
            if (projects.length <= 1) {
                alert('âŒ ë§ˆì§€ë§‰ í”„ë¡œì íŠ¸ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const project = getCurrentProject();
            const projectName = project.apartmentName && project.dong && project.ho 
                ? `${project.apartmentName} ${project.dong} ${project.ho}`
                : 'í˜„ì¬ í”„ë¡œì íŠ¸';

            if (!confirm(`"${projectName}"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                return;
            }

            // í”„ë¡œì íŠ¸ ì‚­ì œ
            projects = projects.filter(p => p.id !== currentProjectId);
            
            // ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸ë¡œ ì „í™˜
            currentProjectId = projects[0].id;
            projectData = getCurrentProject();
            
            // UI ì—…ë°ì´íŠ¸
            loadProjectToUI();
            renderProjectList();
            updateProgress();
            
            showToast('ğŸ—‘ï¸ í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
            saveProjectsToLocalStorage();
        }

        // UIì—ì„œ í˜„ì¬ í”„ë¡œì íŠ¸ë¡œ ë°ì´í„° ì €ì¥
        function saveCurrentProjectFromUI() {
            const project = getCurrentProject();
            
            project.apartmentName = document.getElementById('apartmentName').value;
            project.dong = document.getElementById('dong').value;
            project.ho = document.getElementById('ho').value;
            project.inspectionDate = document.getElementById('inspectionDate').value;
            project.customerName = document.getElementById('customerName').value;
            project.customerPhone = document.getElementById('customerPhone').value;
            
            // floorplan, defects, equipment, airQualityëŠ” ì´ë¯¸ projectData ì°¸ì¡°ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¨
        }

        // í”„ë¡œì íŠ¸ ë°ì´í„°ë¥¼ UIì— ë¡œë“œ
        function loadProjectToUI() {
            const project = getCurrentProject();
            
            document.getElementById('apartmentName').value = project.apartmentName || '';
            document.getElementById('dong').value = project.dong || '';
            document.getElementById('ho').value = project.ho || '';
            document.getElementById('inspectionDate').value = project.inspectionDate || '';
            document.getElementById('customerName').value = project.customerName || '';
            document.getElementById('customerPhone').value = project.customerPhone || '';
            
            // í‰ë©´ë„ í‘œì‹œ
            if (project.floorplan) {
                document.getElementById('floorplanPreview').innerHTML = 
                    `<img src="${project.floorplan}" alt="í‰ë©´ë„" style="max-width: 100%; border-radius: 8px;">`;
            } else {
                document.getElementById('floorplanPreview').innerHTML = '';
            }
            
            // í•˜ì, ì¥ë¹„, ê³µê¸°ì§ˆ ëª©ë¡ ë Œë”ë§
            renderDefects();
            renderEquipment();
            renderAirQuality();
        }

        // í”„ë¡œì íŠ¸ ëª©ë¡ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        function saveProjectsToLocalStorage() {
            try {
                localStorage.setItem('projects', JSON.stringify(projects));
                localStorage.setItem('currentProjectId', currentProjectId);
            } catch (e) {
                console.error('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹¤íŒ¨:', e);
            }
        }

        // í”„ë¡œì íŠ¸ ëª©ë¡ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadProjectsFromLocalStorage() {
            try {
                const savedProjects = localStorage.getItem('projects');
                const savedProjectId = localStorage.getItem('currentProjectId');
                
                if (savedProjects) {
                    projects = JSON.parse(savedProjects);
                    
                    if (savedProjectId) {
                        currentProjectId = parseInt(savedProjectId);
                    } else if (projects.length > 0) {
                        currentProjectId = projects[0].id;
                    }
                    
                    projectData = getCurrentProject();
                } else {
                    // ì²« ì‹¤í–‰ ì‹œ ë¹ˆ í”„ë¡œì íŠ¸ ìƒì„±
                    const newProject = createNewProject();
                    projects.push(newProject);
                    currentProjectId = newProject.id;
                    projectData = getCurrentProject();
                }
                
                renderProjectList();
            } catch (e) {
                console.error('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
                // ì‹¤íŒ¨ ì‹œ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
                const newProject = createNewProject();
                projects.push(newProject);
                currentProjectId = newProject.id;
                projectData = getCurrentProject();
                renderProjectList();
            }
        }

        // ==================== ì´ˆê¸°í™” ====================
        // Google API ë¡œë“œ
        if (typeof gapi !== 'undefined') {
            gapiLoaded();
        }
        if (typeof google !== 'undefined') {
            gisLoaded();
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
        
        // Google API ì´ˆê¸°í™” (í˜ì´ì§€ ë¡œë“œ í›„)
        setTimeout(function() {
            if (typeof gapi !== 'undefined' && gapi.load) {
                console.log('Initializing GAPI...');
                gapi.load('client', initializeGapiClient);
            }
            if (typeof google !== 'undefined' && google.accounts) {
                console.log('Initializing GIS...');
                gisLoaded();
            }
        }, 1000);
            loadProjectsFromLocalStorage(); // í”„ë¡œì íŠ¸ ëª©ë¡ ë¡œë“œ
            loadProjectToUI(); // í˜„ì¬ í”„ë¡œì íŠ¸ UIì— ë¡œë“œ
            renderDefects();
            renderEquipment();
            renderAirQuality();
            renderSavedList();
            updateProgress();
            
            document.getElementById('inspectionDate').valueAsDate = new Date();
        });

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // í•˜ìì ê²€ ë˜ëŠ” ì¥ë¹„ì ê²€ íƒ­ì—ì„œë§Œ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ
            const floatingBtn = document.getElementById('floatingAddBtn');
            if (tabName === 'defects' || tabName === 'equipment') {
                floatingBtn.style.display = 'flex';
            } else {
                floatingBtn.style.display = 'none';
            }
            
            updateProgress();
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            let progress = 0;
            const weights = {
                project: 20,
                floorplan: 15,
                defects: 25,
                equipment: 20,
                airquality: 20
            };

            if (projectData.apartmentName && projectData.dong && projectData.ho) {
                progress += weights.project;
            }

            if (projectData.floorplan) {
                progress += weights.floorplan;
            }

            if (projectData.defects.length > 0) {
                progress += weights.defects;
            }

            if (projectData.equipment && projectData.equipment.length > 0) {
                progress += weights.equipment;
            }

            if (projectData.airQuality.length > 0) {
                progress += weights.airquality;
            }

            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Toast ë©”ì‹œì§€
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        // ==================== í”„ë¡œì íŠ¸ ì •ë³´ ====================
        function saveProject() {
            const newApartmentName = document.getElementById('apartmentName').value;
            const newDong = document.getElementById('dong').value;
            const newHo = document.getElementById('ho').value;
            
            const isNewProject = (
                projectData.apartmentName !== newApartmentName ||
                projectData.dong !== newDong ||
                projectData.ho !== newHo
            ) && (projectData.apartmentName || projectData.dong || projectData.ho);

            if (isNewProject && (projectData.defects.length > 0 || projectData.floorplan || projectData.airQuality.some(r => r.radon || r.formaldehyde || r.vocs))) {
                if (confirm('ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ í•˜ì ì ê²€ ë° ê³µê¸°ì§ˆ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.\n(ì´ì „ í”„ë¡œì íŠ¸ëŠ” "ë°ì´í„°" íƒ­ì—ì„œ ì €ì¥í•˜ì„¸ìš”)')) {
                    projectData.defects = [];
                    projectData.floorplan = null;
                    projectData.equipment = [];
                    projectData.airQuality = [
                        { id: airQualityIdCounter++, name: 'ê±°ì‹¤', radon: '', formaldehyde: '', vocs: '' },
                        { id: airQualityIdCounter++, name: 'ì•ˆë°©', radon: '', formaldehyde: '', vocs: '' },
                        { id: airQualityIdCounter++, name: 'ì‘ì€ë°©1', radon: '', formaldehyde: '', vocs: '' },
                        { id: airQualityIdCounter++, name: 'ì‘ì€ë°©2', radon: '', formaldehyde: '', vocs: '' }
                    ];
                    
                    renderDefects();
                    renderEquipment();
                    renderAirQuality();
                    displayFloorplan();
                    showToast('ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤');
                } else {
                    return;
                }
            }

            projectData.apartmentName = newApartmentName;
            projectData.dong = newDong;
            projectData.ho = newHo;
            projectData.inspectionDate = document.getElementById('inspectionDate').value;
            projectData.customerName = document.getElementById('customerName').value;
            projectData.customerPhone = document.getElementById('customerPhone').value;

            saveToLocalStorage();
            updateProgress();
            showToast('í”„ë¡œì íŠ¸ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ==================== í‰ë©´ë„ ê´€ë¦¬ ====================
        function openFloorplanCamera() {
            currentPhotoTarget = 'floorplan';
            openCamera();
        }

        async function openFloorplanGallery() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const compressed = await compressImage(file);
                    projectData.floorplan = compressed;
                    displayFloorplan();
                    saveToLocalStorage();
                    updateProgress();
                    showToast('í‰ë©´ë„ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            };
            input.click();
        }

        function displayFloorplan() {
            const preview = document.getElementById('floorplanPreview');
            const placeholder = document.getElementById('floorplanPlaceholder');
            
            if (projectData.floorplan) {
                preview.src = projectData.floorplan;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
            } else {
                preview.style.display = 'none';
                placeholder.style.display = 'block';
            }
        }

        function deleteFloorplan() {
            if (confirm('í‰ë©´ë„ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.floorplan = null;
                displayFloorplan();
                saveToLocalStorage();
                updateProgress();
                showToast('í‰ë©´ë„ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        // ==================== í•˜ì ì ê²€ ====================
        function handleFloatingBtnClick() {
            const activeSection = document.querySelector('.section.active');
            if (activeSection.id === 'defects') {
                addDefect();
            } else if (activeSection.id === 'equipment') {
                addEquipment();
            }
        }

        function addDefect() {
            const newDefect = {
                id: defectIdCounter++,
                spaces: [],      // ë°°ì—´ë¡œ ë³€ê²½
                locations: [],   // ë°°ì—´ë¡œ ë³€ê²½
                types: [],       // ë°°ì—´ë¡œ ë³€ê²½
                detailLocation: '',
                description: '',
                photos: [],
                status: 'pending'
            };
            projectData.defects.push(newDefect);
            renderDefects();
            saveToLocalStorage();
            updateProgress();
            showToast('ìƒˆ í•˜ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            
            // ìƒˆë¡œ ì¶”ê°€ëœ í•˜ìë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                const defectsList = document.getElementById('defectsList');
                if (defectsList.lastElementChild) {
                    defectsList.lastElementChild.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function renderDefects() {
            const container = document.getElementById('defectsList');
            
            if (projectData.defects.length === 0) {
                container.innerHTML = '<div class="card" style="text-align: center; color: var(--text-secondary);">ë“±ë¡ëœ í•˜ìê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = projectData.defects.map((defect, index) => {
                // ë°°ì—´ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                if (!defect.spaces) defect.spaces = [];
                if (!defect.locations) defect.locations = [];
                if (!defect.types) defect.types = [];
                
                return `
                <div class="defect-card">
                    <div class="defect-header">
                        <span class="defect-number">í•˜ì ${index + 1}</span>
                        <select class="defect-status ${defect.status === 'completed' ? 'status-completed' : 'status-pending'}" 
                                onchange="updateDefectStatus(${defect.id}, this.value)">
                            <option value="pending" ${defect.status === 'pending' ? 'selected' : ''}>ë¯¸ì™„ë£Œ</option>
                            <option value="completed" ${defect.status === 'completed' ? 'selected' : ''}>ì™„ë£Œ</option>
                        </select>
                    </div>

                    <div class="form-field">
                        <label class="form-label">ğŸ“· ì‚¬ì§„ ì´¬ì˜/ì²¨ë¶€ (í•„ìˆ˜ 2ì¥: ë©€ë¦¬ì„œ â†’ ê°€ê¹Œì´ì„œ)</label>
                        
                        ${defect.photos.length === 0 ? `
                            <div style="text-align: center; padding: 12px; background: rgba(16, 185, 129, 0.1); border: 2px dashed var(--primary); border-radius: 12px;">
                                <div style="font-size: 30px; margin-bottom: 6px;">ğŸ“·</div>
                                <div style="font-size: 14px; font-weight: bold; color: var(--primary); margin-bottom: 8px;">
                                    1ë‹¨ê³„: ë©€ë¦¬ì„œ ì´¬ì˜/ì²¨ë¶€
                                </div>
                                <div style="display: flex; gap: 8px; justify-content: center;">
                                    <button class="btn btn-primary" onclick="startDefectPhotoSequence(${defect.id})" style="flex: 1; max-width: 150px; padding: 10px; font-size: 13px;">
                                        ğŸ“· ì´¬ì˜
                                    </button>
                                    <button class="btn btn-primary" onclick="uploadDefectPhotoFromGallery(${defect.id}, 'far')" style="flex: 1; max-width: 150px; padding: 10px; font-size: 13px;">
                                        ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬
                                    </button>
                                </div>
                            </div>
                        ` : defect.photos.length === 1 ? `
                            <div style="margin-bottom: 10px;">
                                <div style="position: relative; width: 100%;">
                                    <img src="${defect.photos[0]}" alt="ë©€ë¦¬ì„œ" style="width: 100%; height: 220px; object-fit: cover; border-radius: 8px; border: 2px solid var(--primary);">
                                    <div style="position: absolute; bottom: 6px; left: 6px; background: rgba(16, 185, 129, 0.95); color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: bold;">
                                        âœ“ ë©€ë¦¬ì„œ
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: center; padding: 12px; background: rgba(251, 191, 36, 0.1); border: 2px dashed var(--secondary); border-radius: 12px;">
                                <div style="font-size: 30px; margin-bottom: 6px;">ğŸ“·</div>
                                <div style="font-size: 14px; font-weight: bold; color: var(--secondary); margin-bottom: 8px;">
                                    2ë‹¨ê³„: ê°€ê¹Œì´ì„œ ì´¬ì˜/ì²¨ë¶€
                                </div>
                                <div style="display: flex; gap: 8px; justify-content: center;">
                                    <button class="btn btn-secondary" onclick="continueDefectPhotoSequence(${defect.id})" style="flex: 1; max-width: 150px; padding: 10px; font-size: 13px;">
                                        ğŸ“· ì´¬ì˜
                                    </button>
                                    <button class="btn btn-secondary" onclick="uploadDefectPhotoFromGallery(${defect.id}, 'close')" style="flex: 1; max-width: 150px; padding: 10px; font-size: 13px;">
                                        ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬
                                    </button>
                                </div>
                            </div>
                        ` : `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                <div style="position: relative;">
                                    <img src="${defect.photos[0]}" alt="ë©€ë¦¬ì„œ" style="width: 100%; height: 220px; object-fit: cover; border-radius: 8px; border: 2px solid var(--primary);">
                                    <div style="position: absolute; bottom: 6px; left: 6px; background: rgba(16, 185, 129, 0.95); color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: bold;">
                                        âœ“ ë©€ë¦¬ì„œ
                                    </div>
                                </div>
                                <div style="position: relative;">
                                    <img src="${defect.photos[1]}" alt="ê°€ê¹Œì´ì„œ" style="width: 100%; height: 220px; object-fit: cover; border-radius: 8px; border: 2px solid var(--secondary);">
                                    <div style="position: absolute; bottom: 6px; left: 6px; background: rgba(251, 191, 36, 0.95); color: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: bold;">
                                        âœ“ ê°€ê¹Œì´ì„œ
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="retakeDefectPhotos(${defect.id})" style="padding: 8px; font-size: 13px;">
                                ğŸ”„ ë‹¤ì‹œ ì´¬ì˜
                            </button>
                        `}
                    </div>

                    <div class="form-field">
                        <label class="form-label">ê³µê°„ ì„ íƒ (ìµœëŒ€ 4ê°œ)</label>
                        <div class="selected-count">${defect.spaces.length}/4 ì„ íƒë¨</div>
                        <div class="touch-button-grid">
                            ${['í˜„ê´€','ì•ˆë°©','ì¹¨ì‹¤1','ì¹¨ì‹¤2','ì¹¨ì‹¤3','ì¹¨ì‹¤4','ë³µë„','ê±°ì‹¤','ì£¼ë°©','íŒ¬íŠ¸ë¦¬','ì™¸ë¶€','ì•ŒíŒŒë£¸','ë°œì½”ë‹ˆ','ëŒ€í”¼ê³µê°„','ì‹¤ì™¸ê¸°ì‹¤','íŒŒìš°ë”ë£¸','ë“œë ˆìŠ¤ë£¸','ê³µìš©ìš•ì‹¤','ë¶€ë¶€ìš•ì‹¤'].map(space => `
                                <button type="button" class="touch-btn ${defect.spaces.includes(space) ? 'selected' : ''}" 
                                        ${defect.spaces.length >= 4 && !defect.spaces.includes(space) ? 'disabled' : ''}
                                        onclick="toggleDefectSelection(${defect.id}, 'spaces', '${space}')">
                                    ${space}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">ìœ„ì¹˜ ì„ íƒ (ìµœëŒ€ 4ê°œ)</label>
                        <div class="selected-count">${defect.locations.length}/4 ì„ íƒë¨</div>
                        <div class="touch-button-grid">
                            ${['ë²½','ë°”ë‹¥','ì²œì¥','ë„ë°°','ê°€êµ¬','ì°½','ë¬¸','ì§','í‹€','ë§ˆê°íŒ','ìˆ˜ì „','íƒ€ì¼','ë„ì¥','ì¤„ëˆˆ','ì½”í‚¹'].map(location => `
                                <button type="button" class="touch-btn ${defect.locations.includes(location) ? 'selected' : ''}" 
                                        ${defect.locations.length >= 4 && !defect.locations.includes(location) ? 'disabled' : ''}
                                        onclick="toggleDefectSelection(${defect.id}, 'locations', '${location}')">
                                    ${location}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">í•˜ìë‚´ìš© ì„ íƒ (ìµœëŒ€ 4ê°œ)</label>
                        <div class="selected-count">${defect.types.length}/4 ì„ íƒë¨</div>
                        
                        <!-- ìƒë‹¨ ê·¸ë£¹: í•˜ì ìœ í˜• -->
                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 6px; font-weight: 600;">
                                í•˜ì ìœ í˜•
                            </div>
                            <div class="touch-button-grid">
                                ${['ìœ ê²©','í‹ˆìƒˆ','ë‹¨ì°¨','íŒŒì†','ê¸í˜','ì°í˜','ë“¤ëœ¸','ì˜¤ì—¼','ë§ˆê°','ê³ ì •','ìˆ˜í‰/ìˆ˜ì§'].map(type => `
                                    <button type="button" class="touch-btn ${defect.types.includes(type) ? 'selected' : ''}" 
                                            ${defect.types.length >= 4 && !defect.types.includes(type) ? 'disabled' : ''}
                                            onclick="toggleDefectSelection(${defect.id}, 'types', '${type}')">
                                        ${type}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- êµ¬ë¶„ì„  -->
                        <div style="border-top: 1px solid var(--border); margin: 12px 0;"></div>
                        
                        <!-- í•˜ë‹¨ ê·¸ë£¹: ìƒíƒœ/ì •ë„ -->
                        <div>
                            <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 6px; font-weight: 600;">
                                ìƒíƒœ / ì •ë„
                            </div>
                            <div class="touch-button-grid">
                                ${['ì „ì²´','ë‹¤ìˆ˜','ì‘ë™','ë¶ˆëŸ‰','ë¯¸ì‹œê³µ','ì˜¤ì‹œê³µ'].map(type => `
                                    <button type="button" class="touch-btn ${defect.types.includes(type) ? 'selected' : ''}" 
                                            ${defect.types.length >= 4 && !defect.types.includes(type) ? 'disabled' : ''}
                                            onclick="toggleDefectSelection(${defect.id}, 'types', '${type}')">
                                        ${type}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">ìƒì„¸ìœ„ì¹˜</label>
                        <input type="text" class="form-input" value="${defect.detailLocation || ''}" 
                               onchange="updateDefect(${defect.id}, 'detailLocation', this.value)" 
                               placeholder="ì˜ˆ: ë²½ / ë¬¸ / í‹€">
                    </div>

                    <div class="form-field">
                        <label class="form-label">ìƒì„¸ì„¤ëª… (ìë™ ìƒì„±)</label>
                        <textarea class="form-input" rows="3" 
                                  readonly
                                  style="background: rgba(16, 185, 129, 0.05); cursor: default;"
                                  placeholder="ê³µê°„, ìœ„ì¹˜, í•˜ìë‚´ìš©ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤">${defect.description || ''}</textarea>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 5px;">
                            ğŸ’¡ ê³µê°„, ìœ„ì¹˜, í•˜ìë‚´ìš©, ìƒì„¸ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
                        </div>
                    </div>

                    <button class="btn btn-danger" onclick="deleteDefect(${defect.id})">
                        ğŸ—‘ï¸ í•˜ì ì‚­ì œ
                    </button>
                </div>
            `;
            }).join('');
        }

        function startDefectPhotoSequence(defectId) {
            currentPhotoTarget = { defectId: defectId, step: 'far' };
            openCamera();
        }

        function continueDefectPhotoSequence(defectId) {
            currentPhotoTarget = { defectId: defectId, step: 'close' };
            openCamera();
        }

        function retakeDefectPhotos(defectId) {
            if (confirm('ì‚¬ì§„ì„ ë‹¤ì‹œ ì´¬ì˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê¸°ì¡´ ì‚¬ì§„ 2ì¥ì´ ì‚­ì œë©ë‹ˆë‹¤)')) {
                const defect = projectData.defects.find(d => d.id === defectId);
                if (defect) {
                    defect.photos = [];
                    renderDefects();
                    saveToLocalStorage();
                    showToast('ì‚¬ì§„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì´¬ì˜í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        async function uploadDefectPhotoFromGallery(defectId, step) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const compressed = await compressImage(file);
                    const defect = projectData.defects.find(d => d.id === defectId);
                    if (defect) {
                        defect.photos.push(compressed);
                        
                        if (step === 'far') {
                            showToast('âœ“ ë©€ë¦¬ì„œ ì‚¬ì§„ ì¶”ê°€ ì™„ë£Œ! ì´ì œ ê°€ê¹Œì´ì„œ ì´¬ì˜/ì²¨ë¶€í•´ì£¼ì„¸ìš”.');
                        } else if (step === 'close') {
                            showToast('âœ“ ê°€ê¹Œì´ì„œ ì‚¬ì§„ ì¶”ê°€ ì™„ë£Œ! í•˜ì ì‚¬ì§„ì´ ëª¨ë‘ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                        
                        renderDefects();
                        saveToLocalStorage();
                        updateProgress();
                    }
                }
            };
            input.click();
        }

        // ==================== ì¥ë¹„ì ê²€ ====================
        function addEquipment() {
            const newEquipment = {
                id: equipmentIdCounter++,
                space: '',       // ë‹¨ì¼ ê³µê°„
                inspection: 'ë²½ì²´ìˆ˜ì§ ë° ë°”ë‹¥ìˆ˜í‰ / ë‹¨ì—´ì‹œê³µ ì–‘í˜¸',
                photos: {        // ìœ„ì¹˜ë³„ ì‚¬ì§„ ê°ì²´
                    'ì¢Œì¸¡ìƒë‹¨': null,
                    'ì¢Œì¸¡í•˜ë‹¨': null,
                    'ìš°ì¸¡ìƒë‹¨': null,
                    'ìš°ì¸¡í•˜ë‹¨': null
                }
            };
            projectData.equipment.push(newEquipment);
            renderEquipment();
            saveToLocalStorage();
            updateProgress();
            showToast('ìƒˆ ì¥ë¹„ì ê²€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            
            setTimeout(() => {
                const equipmentList = document.getElementById('equipmentList');
                if (equipmentList.lastElementChild) {
                    equipmentList.lastElementChild.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function renderEquipment() {
            const container = document.getElementById('equipmentList');
            
            // equipment ë°°ì—´ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
            if (!projectData.equipment) {
                projectData.equipment = [];
            }
            
            if (projectData.equipment.length === 0) {
                container.innerHTML = '<div class="card" style="text-align: center; color: var(--text-secondary);">ë“±ë¡ëœ ì¥ë¹„ì ê²€ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = projectData.equipment.map((item, index) => {
                // photos ê°ì²´ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™” (í•˜ìœ„ í˜¸í™˜ì„±)
                if (!item.photos) {
                    item.photos = {
                        'ì¢Œì¸¡ìƒë‹¨': null,
                        'ì¢Œì¸¡í•˜ë‹¨': null,
                        'ìš°ì¸¡ìƒë‹¨': null,
                        'ìš°ì¸¡í•˜ë‹¨': null
                    };
                }
                
                const locations = ['ì¢Œì¸¡ìƒë‹¨', 'ì¢Œì¸¡í•˜ë‹¨', 'ìš°ì¸¡ìƒë‹¨', 'ìš°ì¸¡í•˜ë‹¨'];
                const locationColors = {
                    'ì¢Œì¸¡ìƒë‹¨': '#3498db',
                    'ì¢Œì¸¡í•˜ë‹¨': '#2ecc71',
                    'ìš°ì¸¡ìƒë‹¨': '#f39c12',
                    'ìš°ì¸¡í•˜ë‹¨': '#e74c3c'
                };
                
                return `
                <div class="defect-card">
                    <div class="defect-header">
                        <span class="defect-number">NO ${index + 1}</span>
                        <button class="btn btn-danger" onclick="deleteEquipment(${item.id})" style="width: auto; padding: 8px 16px; font-size: 12px;">
                            ğŸ—‘ï¸ ì‚­ì œ
                        </button>
                    </div>

                    <div class="form-field">
                        <label class="form-label">ê³µê°„ ì„ íƒ</label>
                        <div class="touch-button-grid">
                            ${['í˜„ê´€','ì•ˆë°©','ì¹¨ì‹¤1','ì¹¨ì‹¤2','ì¹¨ì‹¤3','ì¹¨ì‹¤4','ë³µë„','ê±°ì‹¤','ì£¼ë°©','íŒ¬íŠ¸ë¦¬','ì™¸ë¶€','ì•ŒíŒŒë£¸','ë°œì½”ë‹ˆ','ëŒ€í”¼ê³µê°„','ì‹¤ì™¸ê¸°ì‹¤','íŒŒìš°ë”ë£¸','ë“œë ˆìŠ¤ë£¸','ê³µìš©ìš•ì‹¤','ë¶€ë¶€ìš•ì‹¤'].map(space => `
                                <button type="button" class="touch-btn ${item.space === space ? 'selected' : ''}" 
                                        onclick="updateEquipmentSpace(${item.id}, '${space}')">
                                    ${space}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">ì ê²€ê²°ê³¼</label>
                        <input type="text" class="form-input" value="${item.inspection}" 
                               onchange="updateEquipment(${item.id}, 'inspection', this.value)" 
                               placeholder="ì˜ˆ: ë²½ì²´ìˆ˜ì§ ë° ë°”ë‹¥ìˆ˜í‰ / ë‹¨ì—´ì‹œê³µ ì–‘í˜¸">
                    </div>

                    <div class="form-field">
                        <label class="form-label">ğŸ“· ìœ„ì¹˜ë³„ ì‚¬ì§„ ì´¬ì˜/ì²¨ë¶€ (${Object.values(item.photos).filter(p => p).length}/4)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            ${locations.map(location => `
                                <div style="border: 2px solid ${locationColors[location]}; border-radius: 8px; overflow: hidden;">
                                    <div style="background: ${locationColors[location]}; color: white; padding: 8px; text-align: center; font-weight: bold; font-size: 13px;">
                                        ${location}
                                    </div>
                                    ${item.photos[location] ? `
                                        <img src="${item.photos[location]}" style="width: 100%; height: 180px; object-fit: cover;">
                                        <div style="display: flex; border-top: 1px solid #ddd;">
                                            <button class="btn btn-secondary" onclick="openEquipmentLocationCamera(${item.id}, '${location}')" style="flex: 1; border-radius: 0; border: none; padding: 8px; font-size: 11px;">
                                                ğŸ”„
                                            </button>
                                            <button class="btn btn-secondary" onclick="openEquipmentLocationGallery(${item.id}, '${location}')" style="flex: 1; border-radius: 0; border: none; border-left: 1px solid #ddd; padding: 8px; font-size: 11px;">
                                                ğŸ–¼ï¸
                                            </button>
                                            <button class="btn btn-danger" onclick="deleteEquipmentLocationPhoto(${item.id}, '${location}')" style="flex: 1; border-radius: 0; border: none; border-left: 1px solid #ddd; padding: 8px; font-size: 11px;">
                                                ğŸ—‘ï¸
                                            </button>
                                        </div>
                                    ` : `
                                        <div style="height: 180px; background: #f8f9fa; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;">
                                            <div style="font-size: 24px; opacity: 0.3;">ğŸ“·</div>
                                            <div style="display: flex; gap: 8px; width: 100%; padding: 0 10px;">
                                                <button class="btn btn-primary" onclick="openEquipmentLocationCamera(${item.id}, '${location}')" style="flex: 1; padding: 6px; font-size: 11px;">
                                                    ì´¬ì˜
                                                </button>
                                                <button class="btn btn-primary" onclick="openEquipmentLocationGallery(${item.id}, '${location}')" style="flex: 1; padding: 6px; font-size: 11px;">
                                                    ì²¨ë¶€
                                                </button>
                                            </div>
                                        </div>
                                    `}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function updateEquipment(id, field, value) {
            const item = projectData.equipment.find(e => e.id === id);
            if (item) {
                item[field] = value;
                saveToLocalStorage();
            }
        }

        function updateEquipmentSpace(id, space) {
            const item = projectData.equipment.find(e => e.id === id);
            if (item) {
                item.space = space;
                renderEquipment();
                saveToLocalStorage();
            }
        }

        function openEquipmentLocationCamera(id, location) {
            currentPhotoTarget = { equipmentId: id, location: location };
            openCamera();
        }

        async function openEquipmentLocationGallery(id, location) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const compressed = await compressImage(file);
                    const item = projectData.equipment.find(e => e.id === id);
                    if (item) {
                        if (!item.photos) {
                            item.photos = {
                                'ì¢Œì¸¡ìƒë‹¨': null,
                                'ì¢Œì¸¡í•˜ë‹¨': null,
                                'ìš°ì¸¡ìƒë‹¨': null,
                                'ìš°ì¸¡í•˜ë‹¨': null
                            };
                        }
                        item.photos[location] = compressed;
                        renderEquipment();
                        saveToLocalStorage();
                        updateProgress();
                        showToast(`${location} ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`);
                    }
                }
            };
            input.click();
        }

        function deleteEquipmentLocationPhoto(id, location) {
            if (confirm(`${location} ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const item = projectData.equipment.find(e => e.id === id);
                if (item && item.photos) {
                    item.photos[location] = null;
                    renderEquipment();
                    saveToLocalStorage();
                    updateProgress();
                    showToast(`${location} ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`);
                }
            }
        }

        function deleteEquipment(id) {
            if (confirm('ì´ ì¥ë¹„ì ê²€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.equipment = projectData.equipment.filter(e => e.id !== id);
                renderEquipment();
                saveToLocalStorage();
                updateProgress();
                showToast('ì¥ë¹„ì ê²€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function openEquipmentCamera(id) {
            currentPhotoTarget = { equipmentId: id };
            openCamera();
        }

        async function openEquipmentGallery(id) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const compressed = await compressImage(file);
                    const item = projectData.equipment.find(e => e.id === id);
                    if (item) {
                        item.photo = compressed;
                        renderEquipment();
                        saveToLocalStorage();
                        showToast('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                }
            };
            input.click();
        }

        function deleteEquipmentPhoto(id) {
            if (confirm('ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const item = projectData.equipment.find(e => e.id === id);
                if (item) {
                    item.photo = null;
                    renderEquipment();
                    saveToLocalStorage();
                    showToast('ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            }
        }

        // ==================== ê³µê¸°ì§ˆ ì¸¡ì • ====================
        function renderAirQuality() {
            const container = document.getElementById('airQualityList');
            
            if (projectData.airQuality.length === 0) {
                projectData.airQuality = [
                    { id: airQualityIdCounter++, name: 'ê±°ì‹¤', radon: '', formaldehyde: '', vocs: '' },
                    { id: airQualityIdCounter++, name: 'ì•ˆë°©', radon: '', formaldehyde: '', vocs: '' },
                    { id: airQualityIdCounter++, name: 'ì‘ì€ë°©1', radon: '', formaldehyde: '', vocs: '' },
                    { id: airQualityIdCounter++, name: 'ì‘ì€ë°©2', radon: '', formaldehyde: '', vocs: '' }
                ];
            }

            container.innerHTML = projectData.airQuality.map((room) => `
                <div class="air-quality-card">
                    <div class="air-room-header">
                        <input type="text" 
                               class="air-room-name-input" 
                               value="${room.name}" 
                               onchange="updateAirRoomName(${room.id}, this.value)"
                               placeholder="ë°© ì´ë¦„">
                        <button class="air-room-delete" onclick="deleteAirRoom(${room.id})">Ã—</button>
                    </div>
                    <div class="air-inputs">
                        <div class="air-input-group">
                            <label>ë¼ëˆ</label>
                            <input type="number" 
                                   value="${room.radon}" 
                                   onchange="updateAirQualityValue(${room.id}, 'radon', this.value)"
                                   placeholder="0">
                            <span>Bq/mÂ³</span>
                        </div>
                        <div class="air-input-group">
                            <label>í¬ë¦„ì•Œë°íˆë“œ</label>
                            <input type="number" 
                                   step="0.001"
                                   value="${room.formaldehyde}" 
                                   onchange="updateAirQualityValue(${room.id}, 'formaldehyde', this.value)"
                                   placeholder="0.000">
                            <span>mg/mÂ³</span>
                        </div>
                        <div class="air-input-group">
                            <label>ì´VOCs</label>
                            <input type="number" 
                                   step="0.001"
                                   value="${room.vocs}" 
                                   onchange="updateAirQualityValue(${room.id}, 'vocs', this.value)"
                                   placeholder="0.000">
                            <span>mg/mÂ³</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addAirQualityRoom() {
            const newRoom = {
                id: airQualityIdCounter++,
                name: `ë°©${projectData.airQuality.length + 1}`,
                radon: '',
                formaldehyde: '',
                vocs: ''
            };
            projectData.airQuality.push(newRoom);
            renderAirQuality();
            saveToLocalStorage();
            updateProgress();
            showToast('ë°©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function deleteAirRoom(id) {
            if (projectData.airQuality.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ë°©ì€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤');
                return;
            }
            if (confirm('ì´ ë°©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.airQuality = projectData.airQuality.filter(r => r.id !== id);
                renderAirQuality();
                saveToLocalStorage();
                updateProgress();
                showToast('ë°©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function updateAirRoomName(id, name) {
            const room = projectData.airQuality.find(r => r.id === id);
            if (room) {
                room.name = name;
                saveToLocalStorage();
            }
        }

        function updateAirQualityValue(id, field, value) {
            const room = projectData.airQuality.find(r => r.id === id);
            if (room) {
                room[field] = value;
                saveToLocalStorage();
                updateProgress();
            }
        }

        // ==================== ì¹´ë©”ë¼ ê¸°ëŠ¥ ====================
        async function openCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                const video = document.getElementById('cameraPreview');
                video.srcObject = cameraStream;
                document.getElementById('cameraModal').classList.add('active');
            } catch (error) {
                alert('ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function closeCameraModal() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            document.getElementById('cameraModal').classList.remove('active');
            currentPhotoTarget = null;
        }

        async function capturePhoto() {
            // ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const video = document.getElementById('cameraPreview');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            
            if (currentPhotoTarget === 'floorplan') {
                projectData.floorplan = imageData;
                displayFloorplan();
                showToast('í‰ë©´ë„ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
            } else if (currentPhotoTarget && typeof currentPhotoTarget === 'object') {
                if (currentPhotoTarget.defectId) {
                    // í•˜ìì ê²€ ì‚¬ì§„
                    const defect = projectData.defects.find(d => d.id === currentPhotoTarget.defectId);
                    if (defect) {
                        defect.photos.push(imageData);
                        
                        if (currentPhotoTarget.step === 'far') {
                            showToast('âœ“ ë©€ë¦¬ì„œ ì´¬ì˜ ì™„ë£Œ! ì´ì œ ê°€ê¹Œì´ì„œ ì´¬ì˜í•´ì£¼ì„¸ìš”.');
                        } else if (currentPhotoTarget.step === 'close') {
                            showToast('âœ“ ê°€ê¹Œì´ì„œ ì´¬ì˜ ì™„ë£Œ! í•˜ì ì‚¬ì§„ì´ ëª¨ë‘ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                        
                        renderDefects();
                    }
                } else if (currentPhotoTarget.equipmentId) {
                    // ì¥ë¹„ì ê²€ ì‚¬ì§„
                    const equipment = projectData.equipment.find(e => e.id === currentPhotoTarget.equipmentId);
                    if (equipment) {
                        if (currentPhotoTarget.location) {
                            // ìœ„ì¹˜ë³„ ì‚¬ì§„
                            if (!equipment.photos) {
                                equipment.photos = {
                                    'ì¢Œì¸¡ìƒë‹¨': null,
                                    'ì¢Œì¸¡í•˜ë‹¨': null,
                                    'ìš°ì¸¡ìƒë‹¨': null,
                                    'ìš°ì¸¡í•˜ë‹¨': null
                                };
                            }
                            equipment.photos[currentPhotoTarget.location] = imageData;
                            showToast(`âœ“ ${currentPhotoTarget.location} ì‚¬ì§„ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        } else {
                            // êµ¬ ë²„ì „ í˜¸í™˜ì„±
                            equipment.photo = imageData;
                            showToast('âœ“ ì‚¬ì§„ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        }
                        renderEquipment();
                    }
                }
            }
            
            saveToLocalStorage();
            updateProgress();
            closeCameraModal();
        }

        function updateDefect(id, field, value) {
            const defect = projectData.defects.find(d => d.id === id);
            if (defect) {
                defect[field] = value;
                
                // ìƒì„¸ìœ„ì¹˜ ë³€ê²½ ì‹œ ìë™ ì„¤ëª… ì¬ìƒì„±
                if (field === 'detailLocation') {
                    generateAutoDescription(id);
                    renderDefects();
                }
                
                saveToLocalStorage();
            }
        }

        function toggleDefectSelection(id, field, value) {
            const defect = projectData.defects.find(d => d.id === id);
            if (!defect) return;
            
            // ë°°ì—´ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
            if (!defect[field]) defect[field] = [];
            
            const index = defect[field].indexOf(value);
            if (index > -1) {
                // ì´ë¯¸ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ ì œê±°
                defect[field].splice(index, 1);
            } else {
                // ì„ íƒë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ ì¶”ê°€ (ìµœëŒ€ 4ê°œê¹Œì§€)
                if (defect[field].length < 4) {
                    defect[field].push(value);
                } else {
                    showToast('ìµœëŒ€ 4ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
                    return;
                }
            }
            
            // ì„ íƒ í›„ ìƒì„¸ì„¤ëª… ìë™ ìƒì„±
            generateAutoDescription(id);
            
            renderDefects();
            saveToLocalStorage();
        }

        function generateAutoDescription(id) {
            const defect = projectData.defects.find(d => d.id === id);
            if (!defect) return;
            
            // ë°°ì—´ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
            if (!defect.spaces) defect.spaces = [];
            if (!defect.locations) defect.locations = [];
            if (!defect.types) defect.types = [];
            
            // ì„ íƒëœ í•­ëª©ì´ ìˆì„ ë•Œë§Œ ìë™ ìƒì„±
            if (defect.spaces.length > 0 || defect.locations.length > 0 || defect.types.length > 0) {
                let description = '';
                
                // ê³µê°„
                if (defect.spaces.length > 0) {
                    description += defect.spaces.join(', ');
                }
                
                // ìœ„ì¹˜
                if (defect.locations.length > 0) {
                    if (description) description += ' ';
                    description += defect.locations.join(' / ');
                }
                
                // í•˜ìë‚´ìš©
                if (defect.types.length > 0) {
                    if (description) description += ' ';
                    description += defect.types.join(', ');
                }
                
                // ìƒì„¸ìœ„ì¹˜ê°€ ìˆìœ¼ë©´ ì¶”ê°€
                if (defect.detailLocation) {
                    if (description) description += ' ';
                    description += defect.detailLocation;
                }
                
                defect.description = description;
            }
        }

        function updateDefectStatus(id, status) {
            const defect = projectData.defects.find(d => d.id === id);
            if (defect) {
                defect.status = status;
                renderDefects();
                saveToLocalStorage();
                showToast(status === 'completed' ? 'í•˜ìê°€ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤' : 'í•˜ìê°€ ë¯¸ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function deleteDefect(id) {
            if (confirm('ì´ í•˜ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.defects = projectData.defects.filter(d => d.id !== id);
                renderDefects();
                saveToLocalStorage();
                updateProgress();
                showToast('í•˜ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        // ==================== ì´ë¯¸ì§€ ì••ì¶• ====================
        async function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        const maxSize = 1200;
                        if (width > height && width > maxSize) {
                            height = (height * maxSize) / width;
                            width = maxSize;
                        } else if (height > maxSize) {
                            width = (width * maxSize) / height;
                            height = maxSize;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // ==================== PDF ìƒì„± ====================
        async function generatePDF() {
            if (!projectData.apartmentName || !projectData.dong || !projectData.ho) {
                alert('í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            showLoading();

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const pageWidth = 210;
                const pageHeight = 297;

                // 1í˜ì´ì§€: ì „ì²´ ìš”ì•½
                const summaryHTML = createSummaryPage();
                await addHTMLPageToPDF(doc, summaryHTML, pageWidth, pageHeight);

                // 2í˜ì´ì§€~: í•˜ì ìƒì„¸ ì‚¬ì§„ (2ê°œì”©, ì‚¬ì§„ 2ì¥ì”©)
                if (projectData.defects.length > 0) {
                    const defectsWithPhotos = projectData.defects.filter(d => d.photos && d.photos.length > 0);
                    
                    if (defectsWithPhotos.length > 0) {
                        for (let i = 0; i < defectsWithPhotos.length; i += 2) {
                            doc.addPage();
                            const batch = defectsWithPhotos.slice(i, i + 2);
                            const detailHTML = createDefectDetailPage(batch, i);
                            await addHTMLPageToPDF(doc, detailHTML, pageWidth, pageHeight);
                        }
                    }
                }

                // ì¥ë¹„ì ê²€ í˜ì´ì§€ (1ê°œì”©)
                if (projectData.equipment && projectData.equipment.length > 0) {
                    // ì‚¬ì§„ì´ í•˜ë‚˜ë¼ë„ ìˆëŠ” í•­ëª©ë§Œ í•„í„°ë§
                    const equipmentWithPhotos = projectData.equipment.filter(e => {
                        if (e.photos && typeof e.photos === 'object') {
                            // ìƒˆ ë²„ì „: photos ê°ì²´ì—ì„œ í•˜ë‚˜ë¼ë„ ì‚¬ì§„ì´ ìˆìœ¼ë©´
                            return Object.values(e.photos).some(photo => photo !== null);
                        }
                        // êµ¬ ë²„ì „: photoê°€ ìˆìœ¼ë©´
                        return e.photo;
                    });
                    
                    if (equipmentWithPhotos.length > 0) {
                        // 1ê°œì”© í˜ì´ì§€ì— í‘œì‹œ
                        for (let i = 0; i < equipmentWithPhotos.length; i++) {
                            doc.addPage();
                            const batch = [equipmentWithPhotos[i]];
                            const equipmentHTML = createEquipmentPage(batch, i);
                            await addHTMLPageToPDF(doc, equipmentHTML, pageWidth, pageHeight);
                        }
                    }
                }

                // ê³µê¸°ì§ˆ ìƒì„¸ í˜ì´ì§€ ì¶”ê°€
                const airQualityWithData = projectData.airQuality.filter(room => 
                    room.radon || room.formaldehyde || room.vocs
                );
                if (airQualityWithData.length > 0) {
                    doc.addPage();
                    const airQualityHTML = createAirQualityDetailPage();
                    await addHTMLPageToPDF(doc, airQualityHTML, pageWidth, pageHeight);
                }

                // ëª¨ë°”ì¼ í˜¸í™˜ ë‹¤ìš´ë¡œë“œ
                const filename = `ë”í™ˆì ê²€_${projectData.apartmentName}_${projectData.dong}${projectData.ho}_${new Date().toISOString().split('T')[0]}.pdf`;
                
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                
                if (isMobile) {
                    const pdfBlob = doc.output('blob');
                    const blobUrl = URL.createObjectURL(pdfBlob);
                    
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    
                    setTimeout(() => {
                        document.body.removeChild(link);
                        URL.revokeObjectURL(blobUrl);
                    }, 100);
                    
                    hideLoading();
                    showToast('PDFê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    doc.save(filename);
                    hideLoading();
                    showToast('PDFê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤');
                }

            } catch (error) {
                console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                hideLoading();
                alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function addHTMLPageToPDF(doc, htmlContent, pageWidth, pageHeight) {
            const tempDiv = document.createElement('div');
            tempDiv.style.width = '794px';
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.background = '#ffffff';
            tempDiv.innerHTML = htmlContent;
            document.body.appendChild(tempDiv);

            const canvas = await html2canvas(tempDiv, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff',
                logging: false
            });

            document.body.removeChild(tempDiv);

            const imgData = canvas.toDataURL('image/jpeg', 0.95);
            const imgWidth = pageWidth;
            const imgHeight = (canvas.height * pageWidth) / canvas.width;
            
            doc.addImage(imgData, 'JPEG', 0, 0, imgWidth, Math.min(imgHeight, pageHeight));
        }

        function createSummaryPage() {
            let defectRows = '';
            const displayDefects = projectData.defects.slice(0, 15);
            displayDefects.forEach((defect, index) => {
                // ë°°ì—´ì„ ë¬¸ìì—´ë¡œ ë³€í™˜ (í•˜ìœ„ í˜¸í™˜ì„±)
                const spaces = defect.spaces ? defect.spaces.join(', ') : (defect.space || '-');
                const locations = defect.locations ? defect.locations.join(', ') : (defect.location || '-');
                const types = defect.types ? defect.types.join(', ') : (defect.type || '-');
                
                // ìƒì„¸ìœ„ì¹˜ì™€ ìƒì„¸ì„¤ëª…ì„ í•©ì¹¨
                const detailLocation = defect.detailLocation || '';
                const description = defect.description || '';
                const combinedDetail = [detailLocation, description].filter(x => x).join(' ');
                
                defectRows += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 8px; text-align: center; font-weight: bold; color: #000000;">${index + 1}</td>
                        <td style="padding: 8px; text-align: center; color: #000000;">${spaces}</td>
                        <td style="padding: 8px; text-align: center; color: #000000;">${locations}</td>
                        <td style="padding: 8px; color: #000000;">${types}</td>
                        <td style="padding: 8px; color: #000000; font-size: 11px;">${combinedDetail || '-'}</td>
                        <td style="padding: 8px; text-align: center; font-size: 11px; color: #000000;">${defect.status === 'completed' ? 'âœ“' : 'â—‹'}</td>
                    </tr>
                `;
            });

            return `
                <div style="width: 794px; min-height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 30px;">
                    <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px; margin-bottom: 25px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h1 style="margin: 0 0 8px 0; font-size: 28px;">ë”í™ˆì ê²€ í•˜ì ë³´ê³ ì„œ</h1>
                                <p style="margin: 0; font-size: 14px; opacity: 0.9;">${projectData.apartmentName} ${projectData.dong} ${projectData.ho} | ${projectData.inspectionDate || ''}</p>
                            </div>
                            <div style="text-align: right; font-size: 12px;">
                                <div style="font-weight: bold; margin-bottom: 4px;">ë”í™ˆì ê²€</div>
                                <div>070-8019-1456</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #000000; border-bottom: 2px solid #3498db; padding-bottom: 6px;">ì„¸ëŒ€ í‰ë©´ë„</h3>
                            ${projectData.floorplan ? `
                                <img src="${projectData.floorplan}" style="width: 100%; max-height: 280px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;" />
                            ` : '<div style="width: 100%; height: 280px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #999;">í‰ë©´ë„ ì—†ìŒ</div>'}
                        </div>

                        <div>
                            <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #000000; border-bottom: 2px solid #3498db; padding-bottom: 6px;">í”„ë¡œì íŠ¸ ì •ë³´</h3>
                            <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd; margin-bottom: 20px; font-size: 13px;">
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; background: #f8f9fa; font-weight: bold; width: 35%; color: #000000;">ì•„íŒŒíŠ¸ëª…</td>
                                    <td style="padding: 10px; color: #000000;">${projectData.apartmentName}</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; background: #f8f9fa; font-weight: bold; color: #000000;">ë™/í˜¸ìˆ˜</td>
                                    <td style="padding: 10px; color: #000000;">${projectData.dong} / ${projectData.ho}</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; background: #f8f9fa; font-weight: bold; color: #000000;">ì ê²€ì¼ì</td>
                                    <td style="padding: 10px; color: #000000;">${projectData.inspectionDate || '-'}</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; background: #f8f9fa; font-weight: bold; color: #000000;">ê³ ê°ëª…</td>
                                    <td style="padding: 10px; color: #000000;">${projectData.customerName || '-'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #000000; border-bottom: 2px solid #e74c3c; padding-bottom: 6px;">í•˜ì ì ê²€ ëª©ë¡ (ì´ ${projectData.defects.length}ê±´)</h3>
                    ${projectData.defects.length > 0 ? `
                        <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd; font-size: 13px;">
                            <thead>
                                <tr style="background: #f8f9fa; border-bottom: 2px solid #ddd;">
                                    <th style="padding: 10px; width: 5%; color: #000000;">No</th>
                                    <th style="padding: 10px; width: 10%; color: #000000;">ê³µê°„</th>
                                    <th style="padding: 10px; width: 10%; color: #000000;">ìœ„ì¹˜</th>
                                    <th style="padding: 10px; width: 12%; color: #000000;">í•˜ìë‚´ìš©</th>
                                    <th style="padding: 10px; width: 50%; color: #000000;">ìƒì„¸ì„¤ëª…</th>
                                    <th style="padding: 10px; width: 8%; color: #000000;">ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody>${defectRows}</tbody>
                        </table>
                    ` : '<p style="text-align: center; color: #999; padding: 40px 0;">ë“±ë¡ëœ í•˜ìê°€ ì—†ìŠµë‹ˆë‹¤</p>'}

                    <div style="position: absolute; bottom: 20px; left: 30px; right: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 11px; color: #000000; text-align: center;">
                        <div>ë”í™ˆì ê²€ | ì „í™”: 070-8019-1456 / 010-9985-0128 | ì‚¬ì „ì ê²€ ì „ë¬¸ì—…ì²´</div>
                    </div>
                </div>
            `;
        }

        function createDefectDetailPage(defects, startIndex) {
            let contentHTML = '';
            
            defects.forEach((defect, idx) => {
                const globalIndex = startIndex + idx + 1;
                const farPhoto = defect.photos && defect.photos.length > 0 ? defect.photos[0] : '';
                const closePhoto = defect.photos && defect.photos.length > 1 ? defect.photos[1] : '';
                
                // ë°°ì—´ì„ ë¬¸ìì—´ë¡œ ë³€í™˜ (í•˜ìœ„ í˜¸í™˜ì„±)
                const spaces = defect.spaces ? defect.spaces.join(', ') : (defect.space || '-');
                const locations = defect.locations ? defect.locations.join(', ') : (defect.location || '-');
                const types = defect.types ? defect.types.join(', ') : (defect.type || '-');
                
                // ìƒì„¸ìœ„ì¹˜ì™€ ìƒì„¸ì„¤ëª…ì„ í•©ì¹¨
                const detailLocation = defect.detailLocation || '';
                const description = defect.description || '';
                const combinedDetail = [detailLocation, description].filter(x => x).join(' ');
                
                contentHTML += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: white; margin-bottom: 20px;">
                        <div style="background: #2c3e50; color: white; padding: 12px; border-radius: 6px; margin-bottom: 15px;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">í•˜ì ${globalIndex}</div>
                            <div style="font-size: 13px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <div><strong>ê³µê°„:</strong> ${spaces}</div>
                                <div><strong>ìœ„ì¹˜:</strong> ${locations}</div>
                                <div style="grid-column: 1 / -1;"><strong>í•˜ìë‚´ìš©:</strong> ${types}</div>
                                ${combinedDetail ? `<div style="grid-column: 1 / -1; font-size: 12px; opacity: 0.9;"><strong>ìƒì„¸ì„¤ëª…:</strong> ${combinedDetail}</div>` : ''}
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <div style="background: #10b981; color: white; padding: 6px; text-align: center; font-weight: bold; font-size: 12px; border-radius: 4px 4px 0 0;">
                                    ğŸ“· ì›ê²½ (ë©€ë¦¬ì„œ)
                                </div>
                                ${farPhoto ? `
                                    <img src="${farPhoto}" style="width: 100%; height: 220px; object-fit: cover; border: 1px solid #ddd; border-top: none;" />
                                ` : `
                                    <div style="width: 100%; height: 220px; background: #f8f9fa; border: 1px solid #ddd; border-top: none; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px;">ì‚¬ì§„ ì—†ìŒ</div>
                                `}
                            </div>

                            <div>
                                <div style="background: #f59e0b; color: white; padding: 6px; text-align: center; font-weight: bold; font-size: 12px; border-radius: 4px 4px 0 0;">
                                    ğŸ“· ê·¼ê²½ (ê°€ê¹Œì´ì„œ)
                                </div>
                                ${closePhoto ? `
                                    <img src="${closePhoto}" style="width: 100%; height: 220px; object-fit: cover; border: 1px solid #ddd; border-top: none;" />
                                ` : `
                                    <div style="width: 100%; height: 220px; background: #f8f9fa; border: 1px solid #ddd; border-top: none; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px;">ì‚¬ì§„ ì—†ìŒ</div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            });

            return `
                <div style="width: 794px; min-height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 30px;">
                    <div style="background: #2c3e50; color: white; padding: 15px 20px; margin-bottom: 25px; border-radius: 8px;">
                        <h2 style="margin: 0; font-size: 20px;">í•˜ì ìƒì„¸ ì‚¬ì§„ (ì›ê²½+ê·¼ê²½)</h2>
                        <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">${projectData.apartmentName} ${projectData.dong} ${projectData.ho}</p>
                    </div>

                    ${contentHTML}

                    <div style="position: absolute; bottom: 20px; left: 30px; right: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 11px; color: #000000;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>í˜ì´ì§€ ${Math.floor(startIndex / 2) + 2}</div>
                            <div>ë”í™ˆì ê²€ | 070-8019-1456</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // === ì¥ë¹„ì ê²€ ì¸¡ì • ë³´ê³ ì„œ í˜ì´ì§€ (3ê°œì”©) ===
        function createEquipmentPage(equipmentList, startIndex) {
            let contentHTML = '';
            
            equipmentList.forEach((item, idx) => {
                const globalIndex = startIndex + idx + 1;
                
                // í•˜ìœ„ í˜¸í™˜ì„±
                const space = item.space || (item.spaces ? item.spaces.join(', ') : '-');
                
                // photos ê°ì²´ê°€ ìˆìœ¼ë©´ ìœ„ì¹˜ë³„ ì‚¬ì§„, ì—†ìœ¼ë©´ ë‹¨ì¼ ì‚¬ì§„ (êµ¬ ë²„ì „)
                const hasLocationPhotos = item.photos && typeof item.photos === 'object';
                
                contentHTML += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: white; margin-bottom: 20px; page-break-inside: avoid;">
                        <!-- í—¤ë” -->
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                            <tr style="background: #2c3e50;">
                                <td colspan="2" style="padding: 10px; text-align: center; color: white; font-weight: bold; font-size: 16px;">
                                    ì¥ë¹„ì ê²€ ${globalIndex} - ${space}
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold; text-align: center; background: #f8f9fa; color: #000000; width: 25%;">ì ê²€ê²°ê³¼</td>
                                <td style="padding: 10px; border: 1px solid #ddd; color: #000000;">${item.inspection || 'ë²½ì²´ìˆ˜ì§ ë° ë°”ë‹¥ìˆ˜í‰ / ë‹¨ì—´ì‹œê³µ ì–‘í˜¸'}</td>
                            </tr>
                        </table>

                        ${hasLocationPhotos ? `
                            <!-- ìœ„ì¹˜ë³„ 4ê°œ ì‚¬ì§„ -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                ${['ì¢Œì¸¡ìƒë‹¨', 'ì¢Œì¸¡í•˜ë‹¨', 'ìš°ì¸¡ìƒë‹¨', 'ìš°ì¸¡í•˜ë‹¨'].map((location, locIdx) => {
                                    const colors = ['#3498db', '#2ecc71', '#f39c12', '#e74c3c'];
                                    const photo = item.photos[location];
                                    
                                    return `
                                        <div style="border: 2px solid ${colors[locIdx]}; border-radius: 6px; overflow: hidden;">
                                            <div style="background: ${colors[locIdx]}; color: white; padding: 6px; text-align: center; font-weight: bold; font-size: 12px;">
                                                ${location}
                                            </div>
                                            ${photo ? `
                                                <img src="${photo}" style="width: 100%; height: 200px; object-fit: cover; display: block;" />
                                            ` : `
                                                <div style="width: 100%; height: 200px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; color: #999; font-size: 11px;">
                                                    ì‚¬ì§„ ì—†ìŒ
                                                </div>
                                            `}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <!-- ë‹¨ì¼ ì‚¬ì§„ (êµ¬ ë²„ì „ í˜¸í™˜) -->
                            <div style="text-align: center;">
                                <div style="background: #2c3e50; color: white; padding: 8px; text-align: center; font-weight: bold; font-size: 12px; border-radius: 4px 4px 0 0;">
                                    ì´¬ì˜ ì‚¬ì§„
                                </div>
                                ${item.photo ? `
                                    <img src="${item.photo}" style="width: 100%; max-height: 350px; object-fit: contain; border: 1px solid #ddd; border-top: none;" />
                                ` : `
                                    <div style="width: 100%; height: 250px; background: #f8f9fa; border: 1px solid #ddd; border-top: none; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px;">ì‚¬ì§„ ì—†ìŒ</div>
                                `}
                            </div>
                        `}
                    </div>
                `;
            });

            return `
                <div style="width: 794px; min-height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 30px;">
                    <div style="background: #2c3e50; color: white; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px;">
                        <h2 style="margin: 0; font-size: 20px;">ì¥ë¹„ ì¸¡ì • ë³´ê³ ì„œ</h2>
                        <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">${projectData.apartmentName} ${projectData.dong} ${projectData.ho} | ${projectData.inspectionDate || ''}</p>
                    </div>

                    ${contentHTML}

                    <div style="position: absolute; bottom: 20px; left: 30px; right: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 11px; color: #000000;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>ë”í™ˆì ê²€ | 070-8019-1456</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createAirQualityDetailPage() {
            const airQualityData = projectData.airQuality.filter(room => 
                room.radon || room.formaldehyde || room.vocs
            );

            // ê¸°ì¤€ì¹˜
            const standards = {
                radon: 148,
                formaldehyde: 0.210,
                vocs: 0.500
            };

            // í‘œ ìƒì„±
            let tableRows = '';
            airQualityData.forEach((room) => {
                const radonValue = parseFloat(room.radon) || 0;
                const formaldehydeValue = parseFloat(room.formaldehyde) || 0;
                const vocsValue = parseFloat(room.vocs) || 0;

                const radonStatus = radonValue > 0 ? (radonValue <= standards.radon ? 'ì í•©' : 'ë¶€ì í•©') : '-';
                const formaldehydeStatus = formaldehydeValue > 0 ? (formaldehydeValue <= standards.formaldehyde ? 'ì í•©' : 'ë¶€ì í•©') : '-';
                const vocsStatus = vocsValue > 0 ? (vocsValue <= standards.vocs ? 'ì í•©' : 'ë¶€ì í•©') : '-';

                tableRows += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 10px; text-align: center; font-weight: bold; background: #f8f9fa; color: #000000;">${room.name}</td>
                        <td style="padding: 10px; text-align: center; color: #000000;">${room.radon || '-'}</td>
                        <td style="padding: 10px; text-align: center; color: ${radonValue > standards.radon ? '#e74c3c' : '#10b981'}; font-weight: bold;">${radonStatus}</td>
                        <td style="padding: 10px; text-align: center; color: #000000;">${room.formaldehyde || '-'}</td>
                        <td style="padding: 10px; text-align: center; color: ${formaldehydeValue > standards.formaldehyde ? '#e74c3c' : '#10b981'}; font-weight: bold;">${formaldehydeStatus}</td>
                        <td style="padding: 10px; text-align: center; color: #000000;">${room.vocs || '-'}</td>
                        <td style="padding: 10px; text-align: center; color: ${vocsValue > standards.vocs ? '#e74c3c' : '#10b981'}; font-weight: bold;">${vocsStatus}</td>
                    </tr>
                `;
            });

            return `
                <div style="width: 794px; min-height: 1123px; background: white; font-family: 'Malgun Gothic', sans-serif; padding: 30px;">
                    <div style="background: linear-gradient(135deg, #16a085 0%, #1abc9c 100%); color: white; padding: 20px; margin-bottom: 25px; border-radius: 8px;">
                        <h1 style="margin: 0 0 8px 0; font-size: 26px;">ì‹¤ë‚´ ê³µê¸°ì§ˆ ì¸¡ì • ê²°ê³¼</h1>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">${projectData.apartmentName} ${projectData.dong} ${projectData.ho} | ${projectData.inspectionDate || ''}</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 18px; color: #000000; border-bottom: 2px solid #16a085; padding-bottom: 8px;">ğŸ“‹ ì¸¡ì • ë°ì´í„°</h3>
                        <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd; font-size: 13px;">
                            <thead>
                                <tr style="background: #f8f9fa; border-bottom: 2px solid #ddd;">
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">ê³µê°„</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">ë¼ëˆ<br>(Bq/mÂ³)</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">íŒì •</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">í¬ë¦„ì•Œë°íˆë“œ<br>(mg/mÂ³)</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">íŒì •</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">ì´VOCs<br>(mg/mÂ³)</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; color: #000000;">íŒì •</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>

                    <div style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; color: #2e7d32; font-size: 16px;">âœ“ ê¶Œê³ ê¸°ì¤€ (ì‹¤ë‚´ê³µê¸°ì§ˆ ê³µì •ì‹œí—˜ê¸°ì¤€)</h4>
                        <div style="font-size: 14px; color: #1b5e20; line-height: 2;">
                            <div>â€¢ ë¼ëˆ(Rn): <strong>148 Bq/mÂ³ ì´í•˜</strong></div>
                            <div>â€¢ í¬ë¦„ì•Œë°íˆë“œ(HCHO): <strong>0.210 mg/mÂ³ ì´í•˜</strong></div>
                            <div>â€¢ ì´íœ˜ë°œì„±ìœ ê¸°í™”í•©ë¬¼(TVOCs): <strong>0.500 mg/mÂ³ ì´í•˜</strong></div>
                        </div>
                    </div>

                    <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="font-size: 12px; color: #856404; line-height: 1.6;">
                            <strong>â€» ì°¸ê³ ì‚¬í•­</strong><br>
                            - ì¸¡ì • ê²°ê³¼ëŠ” ì¸¡ì • ë‹¹ì‹œì˜ í™˜ê²½ ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                            - ë¶€ì í•© íŒì • ì‹œ í™˜ê¸° ë“±ì˜ ì¡°ì¹˜ í›„ ì¬ì¸¡ì •ì„ ê¶Œì¥í•©ë‹ˆë‹¤.<br>
                            - ë¼ëˆ ë†ë„ëŠ” ê³„ì ˆ, ì‹œê°„ëŒ€ì— ë”°ë¼ ë³€ë™ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div style="position: absolute; bottom: 20px; left: 30px; right: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 11px; color: #000000; text-align: center;">
                        <div>ë”í™ˆì ê²€ | ì „í™”: 070-8019-1456 / 010-9985-0128 | ì‚¬ì „ì ê²€ ì „ë¬¸ì—…ì²´</div>
                    </div>
                </div>
            `;
        }

        // ==================== ë°ì´í„° ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ====================
        function saveToLocalStorage() {
            try {
                localStorage.setItem('thehomein_current', JSON.stringify(projectData));
            } catch (e) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', e);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('thehomein_current');
                if (saved) {
                    projectData = JSON.parse(saved);
                    
                    document.getElementById('apartmentName').value = projectData.apartmentName || '';
                    document.getElementById('dong').value = projectData.dong || '';
                    document.getElementById('ho').value = projectData.ho || '';
                    document.getElementById('inspectionDate').value = projectData.inspectionDate || '';
                    document.getElementById('customerName').value = projectData.customerName || '';
                    document.getElementById('customerPhone').value = projectData.customerPhone || '';
                    
                    displayFloorplan();
                    renderDefects();
                    renderEquipment();
                    renderAirQuality();
                    
                    if (projectData.defects.length > 0) {
                        defectIdCounter = Math.max(...projectData.defects.map(d => d.id)) + 1;
                    }
                    if (projectData.equipment && projectData.equipment.length > 0) {
                        equipmentIdCounter = Math.max(...projectData.equipment.map(e => e.id)) + 1;
                    }
                    if (projectData.airQuality.length > 0) {
                        airQualityIdCounter = Math.max(...projectData.airQuality.map(a => a.id)) + 1;
                    }
                }
            } catch (e) {
                console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', e);
            }
        }

        function saveCurrentData() {
            const timestamp = new Date().toISOString();
            const key = `thehomein_${timestamp}`;
            
            try {
                localStorage.setItem(key, JSON.stringify({
                    ...projectData,
                    savedAt: timestamp
                }));
                renderSavedList();
                showToast('ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            } catch (e) {
                alert('ì €ì¥ ì‹¤íŒ¨: ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤');
            }
        }

        function renderSavedList() {
            const container = document.getElementById('savedList');
            const saved = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('thehomein_') && key !== 'thehomein_current') {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        saved.push({ key, data });
                    } catch (e) {
                        console.error('íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
            }
            
            if (saved.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">ì €ì¥ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            container.innerHTML = saved.map(item => `
                <div class="saved-item">
                    <div class="saved-info">
                        <h3>${item.data.apartmentName || 'ì œëª© ì—†ìŒ'} ${item.data.dong} ${item.data.ho}</h3>
                        <p>${new Date(item.data.savedAt).toLocaleString('ko-KR')}</p>
                    </div>
                    <div class="saved-actions">
                        <button class="icon-btn load" onclick="loadSavedData('${item.key}')">ğŸ“‚</button>
                        <button class="icon-btn delete" onclick="deleteSavedData('${item.key}')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function loadSavedData(key) {
            if (confirm('í˜„ì¬ ì‘ì—… ì¤‘ì¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¡œ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    projectData = data;
                    
                    // equipment ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                    if (!projectData.equipment) {
                        projectData.equipment = [];
                    }
                    
                    document.getElementById('apartmentName').value = projectData.apartmentName || '';
                    document.getElementById('dong').value = projectData.dong || '';
                    document.getElementById('ho').value = projectData.ho || '';
                    document.getElementById('inspectionDate').value = projectData.inspectionDate || '';
                    document.getElementById('customerName').value = projectData.customerName || '';
                    document.getElementById('customerPhone').value = projectData.customerPhone || '';
                    
                    displayFloorplan();
                    renderDefects();
                    renderEquipment();
                    renderAirQuality();
                    saveToLocalStorage();
                    updateProgress();
                    
                    showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
                    switchTab('project');
                } catch (e) {
                    alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                }
            }
        }

        function deleteSavedData(key) {
            if (confirm('ì´ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem(key);
                renderSavedList();
                showToast('í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function clearAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                if (confirm('ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•©ë‹ˆë‹¤. ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) {
                    const keysToDelete = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('thehomein_')) {
                            keysToDelete.push(key);
                        }
                    }
                    keysToDelete.forEach(key => localStorage.removeItem(key));
                    
                    projectData = {
                        apartmentName: '',
                        dong: '',
                        ho: '',
                        inspectionDate: '',
                        customerName: '',
                        customerPhone: '',
                        floorplan: null,
                        defects: [],
                        equipment: [],
                        airQuality: []
                    };
                    
                    defectIdCounter = 1;
                    equipmentIdCounter = 1;
                    airQualityIdCounter = 1;
                    
                    document.getElementById('apartmentName').value = '';
                    document.getElementById('dong').value = '';
                    document.getElementById('ho').value = '';
                    document.getElementById('inspectionDate').valueAsDate = new Date();
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    
                    displayFloorplan();
                    renderDefects();
                    renderEquipment();
                    renderAirQuality();
                    renderSavedList();
                    updateProgress();
                    
                    showToast('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            }
        }
    </script>
</body>
</html>
